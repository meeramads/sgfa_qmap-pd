2025-10-27 00:12:24,767 - __main__ - INFO - ✅ Experiment logging configured: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/experiments.log
2025-10-27 00:12:24,767 - __main__ - INFO - ================================================================================
2025-10-27 00:12:24,767 - __main__ - INFO - FACTOR STABILITY ANALYSIS - STARTING
2025-10-27 00:12:24,767 - __main__ - INFO - ================================================================================
2025-10-27 00:12:24,768 - __main__ - INFO - Output directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2
2025-10-27 00:12:24,768 - __main__ - INFO - Running factor stability analysis with 4 independent chains
2025-10-27 00:12:24,768 - __main__ - INFO - Cosine similarity threshold: 0.8
2025-10-27 00:12:24,768 - __main__ - INFO - Minimum match rate: 0.5
2025-10-27 00:12:24,768 - __main__ - INFO - View names: ['volume_sn_voxels', 'clinical']
2025-10-27 00:12:24,768 - __main__ - INFO - Feature counts per view: {'volume_sn_voxels': 1794, 'clinical': 14}
2025-10-27 00:12:24,783 - __main__ - INFO - ================================================================================
2025-10-27 00:12:24,783 - __main__ - INFO - RUNNING 4 CHAINS WITH METHOD: parallel
2025-10-27 00:12:24,783 - __main__ - INFO - ================================================================================
2025-10-27 00:12:25,012 - __main__ - INFO - Base seed: 42
2025-10-27 00:12:25,012 - __main__ - INFO - MCMC config: samples=10000, warmup=3000, chains=4
2025-10-27 00:12:25,012 - __main__ - INFO - JAX will automatically split PRNG key for independent chains
2025-10-27 00:12:25,012 - __main__ - INFO - Chain RNG keys computed via fold_in for reproducibility
2025-10-27 00:12:25,063 - __main__ - INFO - Starting SGFA analysis with 4 chains...
2025-10-27 00:12:25,063 - __main__ - INFO - 🔬 Factor stability mode: Capturing full posterior geometry diagnostics
2025-10-27 00:12:25,063 - __main__ - INFO - ================================================================================
2025-10-27 00:12:25,063 - __main__ - INFO - _RUN_SGFA_ANALYSIS - STARTING
2025-10-27 00:12:25,063 - __main__ - INFO - ================================================================================
2025-10-27 00:12:25,063 - __main__ - INFO - Running SGFA: K=5, n_subjects=86, n_features=1808
2025-10-27 00:12:25,076 - models.models_integration - INFO -    Total features: 1,808
2025-10-27 00:12:25,076 - models.models_integration - INFO -    Views: 2
2025-10-27 00:12:25,076 - models.models_integration - INFO -    Subjects: 86
2025-10-27 00:12:25,076 - models.models_integration - INFO -    Has imaging data: True
2025-10-27 00:12:25,077 - models.models_integration - INFO - ✅ Selected model type: sparse_gfa_fixed
2025-10-27 00:12:25,077 - models.models_integration - INFO - 🏗️ Creating model instance: sparse_gfa_fixed
2025-10-27 00:12:25,077 - models.models_integration - INFO -    Factory method: True
2025-10-27 00:12:25,077 - models.models_integration - INFO -  Model type: sparse_gfa_fixed
2025-10-27 00:12:25,077 - models.models_integration - INFO -  Model factory: True
2025-10-27 00:12:25,077 - models.models_integration - INFO -  Structured management: True
2025-10-27 00:12:25,077 - __main__ - INFO - MCMC configuration: warmup=3000, samples=10000, chains=4
2025-10-27 00:12:25,077 - __main__ - INFO - NUTS kernel parameters: target_accept_prob=0.8, max_tree_depth=10, dense_mass=False
2025-10-27 00:12:25,077 - __main__ - INFO - Creating MCMC sampler with chain_method=parallel...
2025-10-27 00:12:25,077 - __main__ - WARNING - ⚠️  Running chains in explicit sequential mode with JAX cache clearing to prevent OOM
2025-10-27 00:12:25,077 - __main__ - WARNING -     (NumPyro's default chain execution can cause GPU memory accumulation)
2025-10-27 00:12:25,077 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 00:12:25,078 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 00:12:25,078 - __main__ - INFO -       Using init_params: False
2025-10-27 02:12:58,554 - __main__ - INFO -    📊 Global shrinkage prior τ₀_Z = 0.050000
2025-10-27 02:12:58,555 - __main__ - INFO -    📊 View-specific global shrinkage priors (τ₀_W):
2025-10-27 02:12:58,555 - __main__ - INFO -      View 1 (volume_sn_voxels): τ₀_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-27 02:12:58,555 - __main__ - INFO -      View 2 (clinical): τ₀_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 02:12:58,556 - __main__ - INFO -       τ_Z (global shrinkage, factors): 0.069171 ± 0.085648
2025-10-27 02:12:58,556 - __main__ - INFO -       τ_W (global shrinkage, view 1): 800781056.000000 ± 109791712.000000
2025-10-27 02:12:58,556 - __main__ - INFO -       τ_W (global shrinkage, view 2): 0.175991 ± 0.056653
2025-10-27 02:12:58,556 - __main__ - INFO -       c_W (slab scale, loadings): 1.427007
2025-10-27 02:12:58,556 - __main__ - INFO -       c_Z (slab scale, factors): 2.123285
2025-10-27 02:13:02,301 - __main__ - INFO - ✅ Chain 1 cleanup complete
2025-10-27 02:13:13,530 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 02:13:13,531 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 02:13:13,531 - __main__ - INFO -       Using init_params: False
2025-10-27 04:11:37,400 - __main__ - INFO -    📊 Global shrinkage prior τ₀_Z = 0.050000
2025-10-27 04:11:37,401 - __main__ - INFO -    📊 View-specific global shrinkage priors (τ₀_W):
2025-10-27 04:11:37,401 - __main__ - INFO -      View 1 (volume_sn_voxels): τ₀_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-27 04:11:37,401 - __main__ - INFO -      View 2 (clinical): τ₀_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 04:11:37,402 - __main__ - INFO -       τ_Z (global shrinkage, factors): 0.061877 ± 0.024016
2025-10-27 04:11:37,402 - __main__ - INFO -       τ_W (global shrinkage, view 1): 24.367813 ± 3.994977
2025-10-27 04:11:37,402 - __main__ - INFO -       τ_W (global shrinkage, view 2): 0.940202 ± 0.871869
2025-10-27 04:11:37,402 - __main__ - INFO -       c_W (slab scale, loadings): 9.521852
2025-10-27 04:11:37,402 - __main__ - INFO -       c_Z (slab scale, factors): 2.294741
2025-10-27 04:11:41,149 - __main__ - INFO - ✅ Chain 2 cleanup complete
2025-10-27 04:11:52,380 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 04:11:52,380 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 04:11:52,380 - __main__ - INFO -       Using init_params: False
2025-10-27 06:12:28,125 - __main__ - INFO -    📊 Global shrinkage prior τ₀_Z = 0.050000
2025-10-27 06:12:28,126 - __main__ - INFO -    📊 View-specific global shrinkage priors (τ₀_W):
2025-10-27 06:12:28,126 - __main__ - INFO -      View 1 (volume_sn_voxels): τ₀_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-27 06:12:28,126 - __main__ - INFO -      View 2 (clinical): τ₀_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 06:12:28,127 - __main__ - INFO -       τ_Z (global shrinkage, factors): 0.092188 ± 0.080709
2025-10-27 06:12:28,127 - __main__ - INFO -       τ_W (global shrinkage, view 1): 3309097728.000000 ± 231599792.000000
2025-10-27 06:12:28,127 - __main__ - INFO -       τ_W (global shrinkage, view 2): 0.085556 ± 0.007660
2025-10-27 06:12:28,128 - __main__ - INFO -       c_W (slab scale, loadings): 1.558777
2025-10-27 06:12:28,128 - __main__ - INFO -       c_Z (slab scale, factors): 2.492079
2025-10-27 06:12:31,867 - __main__ - INFO - ✅ Chain 3 cleanup complete
2025-10-27 06:12:43,099 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 06:12:43,100 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 06:12:43,100 - __main__ - INFO -       Using init_params: False
2025-10-27 08:13:27,166 - __main__ - INFO -    📊 Global shrinkage prior τ₀_Z = 0.050000
2025-10-27 08:13:27,167 - __main__ - INFO -    📊 View-specific global shrinkage priors (τ₀_W):
2025-10-27 08:13:27,168 - __main__ - INFO -      View 1 (volume_sn_voxels): τ₀_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-27 08:13:27,168 - __main__ - INFO -      View 2 (clinical): τ₀_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 08:13:27,168 - __main__ - INFO -       τ_Z (global shrinkage, factors): 0.194643 ± 0.245673
2025-10-27 08:13:27,168 - __main__ - INFO -       τ_W (global shrinkage, view 1): 10352.485352 ± 1135.542725
2025-10-27 08:13:27,168 - __main__ - INFO -       τ_W (global shrinkage, view 2): 0.004120 ± 0.000455
2025-10-27 08:13:27,168 - __main__ - INFO -       c_W (slab scale, loadings): 1.717102
2025-10-27 08:13:27,168 - __main__ - INFO -       c_Z (slab scale, factors): 1.492511
2025-10-27 08:13:30,912 - __main__ - INFO - ✅ Chain 4 cleanup complete
2025-10-27 08:13:31,062 - __main__ - INFO - Got samples grouped by chain: 4 chains
2025-10-27 08:13:31,062 - __main__ - INFO - Stored full samples for 4 chains for MCMC diagnostics
2025-10-27 08:13:31,062 - __main__ - INFO - W_samples shape: (4, 10000, 1808, 5)
2025-10-27 08:13:31,062 - __main__ - INFO - Z_samples shape: (4, 10000, 86, 5)
2025-10-27 08:13:31,062 - __main__ - INFO -    Result keys: ['W_samples', 'Z_samples', 'samples', 'n_iterations', 'num_chains', 'convergence', 'execution_time', 'robustness_info']
2025-10-27 08:13:31,062 - __main__ - INFO - ✅ All 4 chains completed successfully
2025-10-27 08:13:31,123 - optimization.profiler - INFO - Performance: all_chains: 28866.000s, 9.40GB peak, 100.0% CPU
2025-10-27 08:13:31,123 - __main__ - INFO - W_samples shape: (4, 10000, 1808, 5)
2025-10-27 08:13:31,123 - __main__ - INFO - Z_samples shape: (4, 10000, 86, 5)
2025-10-27 08:13:31,123 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,123 - __main__ - INFO - VALIDATING MCMC SAMPLES (NaN/Inf CHECK)
2025-10-27 08:13:31,123 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,492 - __main__ - INFO - W (factor loadings) validation:
2025-10-27 08:13:31,493 - __main__ - INFO -   Total elements: 361,600,000
2025-10-27 08:13:31,493 - __main__ - INFO -   NaN values: 0 (0.0000%)
2025-10-27 08:13:31,493 - __main__ - INFO -   Inf values: 0 (0.0000%)
2025-10-27 08:13:31,493 - __main__ - INFO -   ✓ All W samples are valid (finite)
2025-10-27 08:13:31,509 - __main__ - INFO - Z (factor scores) validation:
2025-10-27 08:13:31,509 - __main__ - INFO -   Total elements: 17,200,000
2025-10-27 08:13:31,509 - __main__ - INFO -   NaN values: 0 (0.0000%)
2025-10-27 08:13:31,509 - __main__ - INFO -   Inf values: 0 (0.0000%)
2025-10-27 08:13:31,509 - __main__ - INFO -   ✓ All Z samples are valid (finite)
2025-10-27 08:13:31,509 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,509 - __main__ - INFO - ✓ SAMPLE VALIDATION PASSED - All samples are valid
2025-10-27 08:13:31,509 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,509 - __main__ - INFO - Processing chain 1/4...
2025-10-27 08:13:31,524 - __main__ - INFO - Chain 0 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-27 08:13:31,525 - __main__ - INFO - Processing chain 2/4...
2025-10-27 08:13:31,539 - __main__ - INFO - Chain 1 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-27 08:13:31,540 - __main__ - INFO - Processing chain 3/4...
2025-10-27 08:13:31,555 - __main__ - INFO - Chain 2 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-27 08:13:31,555 - __main__ - INFO - Processing chain 4/4...
2025-10-27 08:13:31,570 - __main__ - INFO - Chain 3 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-27 08:13:31,570 - __main__ - INFO - ✅ All chains completed in 28866.0s (481.1 min)
2025-10-27 08:13:31,570 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,570 - __main__ - INFO - ASSESSING FACTOR STABILITY ACROSS CHAINS
2025-10-27 08:13:31,570 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,570 - __main__ - INFO - Number of chains to analyze: 4
2025-10-27 08:13:31,570 - __main__ - INFO - Cosine threshold: 0.8
2025-10-27 08:13:31,570 - __main__ - INFO - Min match rate: 0.5
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - ASSESS_FACTOR_STABILITY_COSINE - STARTING
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - Number of chains: 4
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - Similarity threshold: 0.8
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - Min match rate: 0.5
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - Chain 0: W type=<class 'list'>, samples=True
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - Chain 1: W type=<class 'list'>, samples=True
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - Chain 2: W type=<class 'list'>, samples=True
2025-10-27 08:13:31,570 - analysis.factor_stability - INFO - Chain 3: W type=<class 'list'>, samples=True
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 0: Averaging 10000 posterior samples
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 0: Multi-view W concatenated to shape (1808, 5)
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 1: Averaging 10000 posterior samples
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 1: Multi-view W concatenated to shape (1808, 5)
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 2: Averaging 10000 posterior samples
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 2: Multi-view W concatenated to shape (1808, 5)
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 3: Averaging 10000 posterior samples
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Chain 3: Multi-view W concatenated to shape (1808, 5)
2025-10-27 08:13:31,571 - analysis.factor_stability - INFO - Factor loading matrices: D=1808 features, K=5 factors
2025-10-27 08:13:31,572 - analysis.factor_stability - INFO - Chain 0: Averaged Z shape (86, 5)
2025-10-27 08:13:31,572 - analysis.factor_stability - INFO - Chain 1: Averaged Z shape (86, 5)
2025-10-27 08:13:31,573 - analysis.factor_stability - INFO - Chain 2: Averaged Z shape (86, 5)
2025-10-27 08:13:31,574 - analysis.factor_stability - INFO - Chain 3: Averaged Z shape (86, 5)
2025-10-27 08:13:31,574 - analysis.factor_stability - INFO - Step 2: Matching 5 factors across 4 chains
2025-10-27 08:13:31,574 - analysis.factor_stability - INFO -   Using sign-invariant cosine similarity (handles factor sign flips)
2025-10-27 08:13:31,574 - analysis.factor_stability - INFO -   Zero-vector detection enabled (threshold: 1e-10)
2025-10-27 08:13:31,574 - analysis.factor_stability - INFO -   Processing factor 0/5
2025-10-27 08:13:31,575 - analysis.factor_stability - INFO - Factor 0: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 08:13:31,575 - analysis.factor_stability - INFO - Factor 1: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 08:13:31,576 - analysis.factor_stability - INFO - Factor 2: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 08:13:31,576 - analysis.factor_stability - INFO - Factor 3: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 08:13:31,576 - analysis.factor_stability - INFO - Factor 4: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 08:13:31,576 - analysis.factor_stability - INFO - 
📊 Cosine Similarity Edge Case Summary:
2025-10-27 08:13:31,576 - analysis.factor_stability - INFO -   Zero reference vectors encountered: 0
2025-10-27 08:13:31,576 - analysis.factor_stability - INFO -   Zero comparison vectors encountered: 0
2025-10-27 08:13:31,576 - analysis.factor_stability - INFO -   Sign flips detected (|sim_raw| < -0.5): 0
2025-10-27 08:13:31,577 - analysis.factor_stability - INFO -   Total factor comparisons: 75
2025-10-27 08:13:31,577 - analysis.factor_stability - INFO - Computing consensus loadings for all 5 factors
2025-10-27 08:13:31,577 - analysis.factor_stability - INFO -   (Stable factors: 5/5)
2025-10-27 08:13:31,577 - analysis.factor_stability - INFO - Computing consensus scores for all 5 factors
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO - Consensus Z computed with uncertainty quantification
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   Median Z: shape (86, 5)
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   Mean std per subject: 0.255
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   Max std per subject: 1.987
2025-10-27 08:13:31,578 - analysis.factor_stability - WARNING -   ⚠️  8 subjects have high uncertainty (>95th percentile)
2025-10-27 08:13:31,578 - analysis.factor_stability - WARNING -      Consider: More chains, longer sampling, or model issues
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO - ASSESS_FACTOR_STABILITY_COSINE - COMPLETED
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO - Results:
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - Stable factors: 5/5
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - Stability rate: 100.0%
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - Stable factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - Consensus W shape: (1808, 5)
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - Consensus Z shape: (86, 5)
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - Z posterior uncertainty quantified (std, CI)
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO - Factor stability analysis complete:
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - 5/5 factors are robust (100.0%)
2025-10-27 08:13:31,578 - analysis.factor_stability - INFO -   - Stable factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:31,578 - __main__ - INFO - ✅ Stability analysis completed
2025-10-27 08:13:31,578 - __main__ - INFO -    Stable factors: 5/5
2025-10-27 08:13:31,578 - __main__ - INFO -    Stability rate: 100.0%
2025-10-27 08:13:31,578 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,578 - __main__ - INFO - COUNTING EFFECTIVE FACTORS PER CHAIN
2025-10-27 08:13:31,578 - __main__ - INFO - ================================================================================
2025-10-27 08:13:31,578 - __main__ - INFO - Thresholds:
2025-10-27 08:13:31,578 - __main__ - INFO -   - Sparsity: 0.001, Min nonzero %: 0.01
2025-10-27 08:13:31,578 - __main__ - INFO -   - ARD precision threshold: 100.0
2025-10-27 08:13:31,578 - __main__ - INFO -   - ARD variance threshold: 0.01
2025-10-27 08:13:31,579 - __main__ - WARNING - ⚠ tau_W samples not available - ARD-based method will be skipped
2025-10-27 08:13:31,579 - __main__ - INFO - 
============================================================
2025-10-27 08:13:31,579 - __main__ - INFO - CHAIN 0 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 08:13:31,579 - __main__ - INFO - ============================================================
2025-10-27 08:13:31,579 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-27 08:13:31,579 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 08:13:31,579 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:31,579 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:31,579 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:31,579 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-27 08:13:31,980 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 08:13:31,980 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:31,980 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:31,980 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:31,980 - __main__ - INFO - 
Chain 0 - Method Comparison:
2025-10-27 08:13:31,980 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-27 08:13:31,980 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-27 08:13:31,980 - __main__ - INFO - 
============================================================
2025-10-27 08:13:31,980 - __main__ - INFO - CHAIN 1 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 08:13:31,980 - __main__ - INFO - ============================================================
2025-10-27 08:13:31,980 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-27 08:13:31,981 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 08:13:31,981 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:31,981 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:31,981 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:31,981 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-27 08:13:32,700 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:32,701 - __main__ - INFO - 
Chain 1 - Method Comparison:
2025-10-27 08:13:32,701 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-27 08:13:32,701 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-27 08:13:32,701 - __main__ - INFO - 
============================================================
2025-10-27 08:13:32,701 - __main__ - INFO - CHAIN 2 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 08:13:32,701 - __main__ - INFO - ============================================================
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:32,701 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-27 08:13:33,125 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 08:13:33,125 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:33,125 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:33,125 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:33,125 - __main__ - INFO - 
Chain 2 - Method Comparison:
2025-10-27 08:13:33,125 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-27 08:13:33,125 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-27 08:13:33,125 - __main__ - INFO - 
============================================================
2025-10-27 08:13:33,125 - __main__ - INFO - CHAIN 3 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 08:13:33,125 - __main__ - INFO - ============================================================
2025-10-27 08:13:33,125 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-27 08:13:33,126 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 08:13:33,126 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:33,126 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:33,126 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:33,126 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-27 08:13:33,555 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 08:13:33,555 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-27 08:13:33,555 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 08:13:33,555 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-27 08:13:33,555 - __main__ - INFO - 
Chain 3 - Method Comparison:
2025-10-27 08:13:33,555 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-27 08:13:33,555 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-27 08:13:33,555 - __main__ - INFO - 
================================================================================
2025-10-27 08:13:33,555 - __main__ - INFO - EFFECTIVE FACTOR SUMMARY (Using preferred method)
2025-10-27 08:13:33,555 - __main__ - INFO - ================================================================================
2025-10-27 08:13:33,555 - __main__ - INFO - Chain 0 (Posterior Samples): 5/5 effective factors
2025-10-27 08:13:33,556 - __main__ - INFO - Chain 1 (Posterior Samples): 5/5 effective factors
2025-10-27 08:13:33,556 - __main__ - INFO - Chain 2 (Posterior Samples): 5/5 effective factors
2025-10-27 08:13:33,556 - __main__ - INFO - Chain 3 (Posterior Samples): 5/5 effective factors
2025-10-27 08:13:33,556 - __main__ - INFO - ================================================================================
2025-10-27 08:13:33,556 - __main__ - INFO - R-HAT CONVERGENCE DIAGNOSTICS
2025-10-27 08:13:33,556 - __main__ - INFO - ================================================================================
2025-10-27 08:13:33,556 - __main__ - INFO - NOTE: Raw R-hat reported for completeness. Aligned R-hat (below) is primary metric.
2025-10-27 08:13:33,556 - __main__ - INFO - 
2025-10-27 08:13:34,118 - __main__ - INFO - R-hat for W (factor loadings):
2025-10-27 08:13:34,119 - __main__ - INFO -   Overall: max=7.6298, mean=4.0489
2025-10-27 08:13:34,119 - __main__ - INFO -   Factor 0: max=5.1992, mean=4.3116 ⚠️
2025-10-27 08:13:34,119 - __main__ - INFO -   Factor 1: max=4.7095, mean=3.8065 ⚠️
2025-10-27 08:13:34,119 - __main__ - INFO -   Factor 2: max=5.4335, mean=4.2117 ⚠️
2025-10-27 08:13:34,119 - __main__ - INFO -   Factor 3: max=5.3404, mean=3.6418 ⚠️
2025-10-27 08:13:34,119 - __main__ - INFO -   Factor 4: max=7.6298, mean=4.2728 ⚠️
2025-10-27 08:13:34,119 - __main__ - WARNING - ⚠️  High raw R-hat detected for W: 7.6298 > 1.1
2025-10-27 08:13:34,119 - __main__ - WARNING -      This may reflect sign/rotation ambiguity in factor models.
2025-10-27 08:13:34,119 - __main__ - WARNING -      Check aligned R-hat below for true convergence assessment.
2025-10-27 08:13:34,149 - __main__ - INFO - R-hat for Z (factor scores):
2025-10-27 08:13:34,149 - __main__ - INFO -   Overall: max=65.8272, mean=11.1798
2025-10-27 08:13:34,149 - __main__ - INFO -   Factor 0: max=39.4220, mean=11.9937 ⚠️
2025-10-27 08:13:34,149 - __main__ - INFO -   Factor 1: max=13.4738, mean=4.5655 ⚠️
2025-10-27 08:13:34,149 - __main__ - INFO -   Factor 2: max=64.3997, mean=14.6851 ⚠️
2025-10-27 08:13:34,149 - __main__ - INFO -   Factor 3: max=45.5035, mean=12.1979 ⚠️
2025-10-27 08:13:34,149 - __main__ - INFO -   Factor 4: max=65.8272, mean=12.4571 ⚠️
2025-10-27 08:13:34,149 - __main__ - WARNING - ⚠️  High raw R-hat detected for Z: 65.8272 > 1.1
2025-10-27 08:13:34,149 - __main__ - WARNING -      This may reflect sign/rotation ambiguity in factor models.
2025-10-27 08:13:34,149 - __main__ - WARNING -      Check aligned R-hat below for true convergence assessment.
2025-10-27 08:13:34,149 - __main__ - INFO - ================================================================================
2025-10-27 08:13:34,149 - __main__ - INFO - ALIGNED R-HAT - PRIMARY CONVERGENCE METRIC
2025-10-27 08:13:34,150 - __main__ - INFO - (Accounts for sign/rotation indeterminacy in factor models)
2025-10-27 08:13:34,150 - __main__ - INFO - ================================================================================
2025-10-27 08:13:34,150 - __main__ - INFO - Computing aligned R-hat for W (factor loadings)...
2025-10-27 08:13:34,150 - analysis.factor_stability - INFO - Computing aligned R-hat (accounting for factor sign/rotation ambiguity)
2025-10-27 08:13:34,150 - analysis.factor_stability - INFO -   Input shape: (4, 10000, 1808, 5)
2025-10-27 08:13:34,150 - analysis.factor_stability - INFO -   Reference chain: 0
2025-10-27 08:13:35,285 - analysis.factor_stability - INFO -   Aligned 4/4 chains to reference
2025-10-27 08:13:35,285 - analysis.factor_stability - INFO -   ✓ All factors matched across chains (good stability)
2025-10-27 08:13:35,930 - analysis.factor_stability - INFO -   Computing split Gelman-Rubin on 5 matched factors...
2025-10-27 08:13:36,492 - analysis.factor_stability - INFO -   Aligned R-hat results (matched factors only):
2025-10-27 08:13:36,492 - analysis.factor_stability - INFO -     Max R-hat overall:  6.7131
2025-10-27 08:13:36,492 - analysis.factor_stability - INFO -     Mean R-hat overall: 4.1622
2025-10-27 08:13:36,492 - analysis.factor_stability - INFO -     Parameters with R-hat < 1.1: 33/9040 (0.4%)
2025-10-27 08:13:36,496 - __main__ - INFO - Aligned R-hat for W:
2025-10-27 08:13:36,496 - __main__ - INFO -   Factor match rate:  100.0% (5/5 factors matched across all chains)
2025-10-27 08:13:36,496 - __main__ - INFO -   Max R-hat overall:  6.7131
2025-10-27 08:13:36,496 - __main__ - INFO -   Mean R-hat overall: 4.1622
2025-10-27 08:13:36,496 - __main__ - INFO -   Convergence rate:   0.4% (R-hat < 1.1)
2025-10-27 08:13:36,496 - __main__ - WARNING - ⚠ W: Good matching but poor R-hat (6.7131 >= 1.1) - need more samples
2025-10-27 08:13:36,496 - __main__ - INFO - ⚡ Alignment improved R-hat by 0.92
2025-10-27 08:13:36,496 - __main__ - INFO -    Raw: 7.6298 → Aligned: 6.7131
2025-10-27 08:13:36,496 - __main__ - INFO - Computing aligned R-hat for Z (factor scores)...
2025-10-27 08:13:36,496 - analysis.factor_stability - INFO - Computing aligned R-hat (accounting for factor sign/rotation ambiguity)
2025-10-27 08:13:36,496 - analysis.factor_stability - INFO -   Input shape: (4, 10000, 86, 5)
2025-10-27 08:13:36,496 - analysis.factor_stability - INFO -   Reference chain: 0
2025-10-27 08:13:36,546 - analysis.factor_stability - INFO -   Aligned 4/4 chains to reference
2025-10-27 08:13:36,546 - analysis.factor_stability - INFO -   ✓ All factors matched across chains (good stability)
2025-10-27 08:13:36,576 - analysis.factor_stability - INFO -   Computing split Gelman-Rubin on 5 matched factors...
2025-10-27 08:13:36,607 - analysis.factor_stability - INFO -   Aligned R-hat results (matched factors only):
2025-10-27 08:13:36,607 - analysis.factor_stability - INFO -     Max R-hat overall:  67.8177
2025-10-27 08:13:36,607 - analysis.factor_stability - INFO -     Mean R-hat overall: 11.5556
2025-10-27 08:13:36,607 - analysis.factor_stability - INFO -     Parameters with R-hat < 1.1: 0/430 (0.0%)
2025-10-27 08:13:36,608 - __main__ - INFO - Aligned R-hat for Z:
2025-10-27 08:13:36,608 - __main__ - INFO -   Factor match rate:  100.0% (5/5 factors matched across all chains)
2025-10-27 08:13:36,608 - __main__ - INFO -   Max R-hat overall:  67.8177
2025-10-27 08:13:36,608 - __main__ - INFO -   Mean R-hat overall: 11.5556
2025-10-27 08:13:36,608 - __main__ - INFO -   Convergence rate:   0.0% (R-hat < 1.1)
2025-10-27 08:13:36,608 - __main__ - WARNING - ⚠ Z: Good matching but poor R-hat (67.8177 >= 1.1) - need more samples
2025-10-27 08:13:36,608 - __main__ - INFO - ================================================================================
2025-10-27 08:13:36,608 - __main__ - INFO - EFFECTIVE SAMPLE SIZE (ESS) DIAGNOSTICS
2025-10-27 08:13:36,608 - __main__ - INFO - ================================================================================
2025-10-27 08:13:36,608 - __main__ - INFO - Computing ESS for W (factor loadings)...
2025-10-27 08:13:36,608 - __main__ - WARNING - Failed to compute ESS diagnostics: effective_sample_size() got an unexpected keyword argument 'split_chains'
2025-10-27 08:13:36,609 - __main__ - WARNING - Traceback (most recent call last):
  File "/cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/experiments/robustness_testing.py", line 2862, in run_factor_stability_analysis
    ess_W_bulk = effective_sample_size(W_samples, split_chains=True)
TypeError: effective_sample_size() got an unexpected keyword argument 'split_chains'

2025-10-27 08:13:36,609 - __main__ - INFO - ================================================================================
2025-10-27 08:13:36,610 - __main__ - INFO - BFMI (BAYESIAN FRACTION OF MISSING INFORMATION)
2025-10-27 08:13:36,610 - __main__ - INFO - ================================================================================
2025-10-27 08:13:36,610 - __main__ - WARNING - No potential energy available - skipping BFMI computation
2025-10-27 08:13:37,032 - __main__ - INFO -   Using stored full chain samples (4 chains) with hyperparameters
2025-10-27 08:13:37,180 - __main__ - WARNING -   Using RAW W_samples for plots (alignment not available)
2025-10-27 08:13:37,180 - __main__ - WARNING -   Using RAW Z_samples for plots (alignment not available)
2025-10-27 08:13:37,180 - __main__ - INFO -   W_samples shape: (4, 10000, 1808, 5)
2025-10-27 08:13:37,180 - __main__ - INFO -   Z_samples shape: (4, 10000, 86, 5)
2025-10-27 08:13:37,180 - __main__ - INFO - 📁 Using experiment output dir: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2
2025-10-27 08:13:37,180 - __main__ - INFO - 📁 Individual plots will be saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots
2025-10-27 08:13:37,182 - __main__ - INFO -    Created trace diagnostics directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots/trace_diagnostics
2025-10-27 08:13:37,182 - analysis.mcmc_diagnostics - INFO - Creating MCMC trace diagnostic plots...
2025-10-27 08:13:37,182 - analysis.mcmc_diagnostics - INFO -   Creating W trace plots for 5 factors...
2025-10-27 08:13:37,294 - analysis.mcmc_diagnostics - INFO -   Creating Z trace plots for 5 factors...
2025-10-27 08:13:37,944 - analysis.mcmc_diagnostics - INFO -   R-hat for W: max=7.6298, mean=4.0489, median=4.3876
2025-10-27 08:13:37,944 - analysis.mcmc_diagnostics - INFO -   R-hat for Z: max=65.8272, mean=11.1798, median=7.0264
2025-10-27 08:13:37,944 - analysis.mcmc_diagnostics - INFO -   Convergence: W=0.8% < 1.1, Z=0.0% < 1.1
2025-10-27 08:16:49,830 - analysis.mcmc_diagnostics - INFO -   Saving individual R-hat evolution plots to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots/trace_diagnostics
2025-10-27 08:16:57,901 - analysis.mcmc_diagnostics - INFO -   ✅ Saved 5 individual R-hat evolution plots for W
2025-10-27 08:16:57,901 - analysis.mcmc_diagnostics - INFO -   ✅ Saved 5 individual R-hat evolution plots for Z
2025-10-27 08:17:16,367 - analysis.mcmc_diagnostics - INFO -   ✅ Saved 20 individual autocorrelation plots for W
2025-10-27 08:17:16,368 - analysis.mcmc_diagnostics - INFO -   ✅ Saved 20 individual autocorrelation plots for Z
2025-10-27 08:17:16,368 - analysis.mcmc_diagnostics - INFO - Creating parameter distribution plots...
2025-10-27 08:17:19,474 - analysis.mcmc_diagnostics - INFO -   Saving individual W and Z distribution plots to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots/wz_distributions
2025-10-27 08:17:24,586 - analysis.mcmc_diagnostics - INFO -   ✅ Saved 5 individual W distribution plots
2025-10-27 08:17:24,586 - analysis.mcmc_diagnostics - INFO -   ✅ Saved 5 individual Z distribution plots
2025-10-27 08:17:24,586 - analysis.mcmc_diagnostics - INFO - Creating hyperparameter posterior plots...
2025-10-27 08:17:24,587 - analysis.mcmc_diagnostics - INFO -   Individual plots will be saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots/hyperparameters
2025-10-27 08:17:24,587 - analysis.mcmc_diagnostics - INFO -   Detected 2 data sources, 5 factors
2025-10-27 08:17:35,727 - analysis.mcmc_diagnostics - INFO -   ✓ Saved individual plots to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots/hyperparameters
2025-10-27 08:17:35,727 - analysis.mcmc_diagnostics - INFO - Creating hyperparameter trace plots...
2025-10-27 08:17:35,727 - analysis.mcmc_diagnostics - INFO -   Individual trace plots will be saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots/hyperparameters
2025-10-27 08:17:35,727 - analysis.mcmc_diagnostics - INFO -   Detected 2 views, 5 factors, 10000 samples
2025-10-27 08:17:35,727 - analysis.mcmc_diagnostics - INFO -   Including sigma (noise precision) traces
2025-10-27 08:17:35,727 - analysis.mcmc_diagnostics - INFO -   Including cW (slab scale for loadings) traces
2025-10-27 08:17:35,727 - analysis.mcmc_diagnostics - INFO -   Including cZ (slab scale for factors) traces
2025-10-27 08:17:39,171 - analysis.mcmc_diagnostics - INFO - 📊 Analyzing factor variance profile (ARD shrinkage assessment)...
2025-10-27 08:17:39,171 - analysis.mcmc_diagnostics - INFO -    Z_samples shape: 4 chains × 10000 samples × 86 subjects × 5 factors
2025-10-27 08:17:39,213 - analysis.mcmc_diagnostics - INFO -    Total factors (K): 5
2025-10-27 08:17:39,213 - analysis.mcmc_diagnostics - INFO -    Active factors (var > 0.1): 2
2025-10-27 08:17:39,213 - analysis.mcmc_diagnostics - INFO -    Effective dimensionality (90% variance): 4
2025-10-27 08:17:39,214 - analysis.mcmc_diagnostics - INFO -    Max factor variance: 0.2419
2025-10-27 08:17:39,214 - analysis.mcmc_diagnostics - INFO -    Top 5 factor variances (mean ± std):
2025-10-27 08:17:39,214 - analysis.mcmc_diagnostics - INFO -       Factor #4: 0.2419 ± 0.4013 [95% CI: 0.0005, 1.0979]
2025-10-27 08:17:39,214 - analysis.mcmc_diagnostics - INFO -       Factor #1: 0.2085 ± 0.2344 [95% CI: 0.0036, 0.6654]
2025-10-27 08:17:39,214 - analysis.mcmc_diagnostics - INFO -       Factor #5: 0.0721 ± 0.1007 [95% CI: 0.0013, 0.2508]
2025-10-27 08:17:39,214 - analysis.mcmc_diagnostics - INFO -       Factor #3: 0.0675 ± 0.0743 [95% CI: 0.0004, 0.1899]
2025-10-27 08:17:39,214 - analysis.mcmc_diagnostics - INFO -       Factor #2: 0.0023 ± 0.0031 [95% CI: 0.0000, 0.0103]
2025-10-27 08:17:39,262 - __main__ - INFO -    📊 Variance Profile Summary:
2025-10-27 08:17:39,262 - __main__ - INFO -       Total factors (K): 5
2025-10-27 08:17:39,262 - __main__ - INFO -       Active factors (var > 0.1): 2
2025-10-27 08:17:39,263 - __main__ - INFO -       Effective dimensionality (90% var): 4
2025-10-27 08:17:39,263 - __main__ - WARNING -       ⚠️  Mismatch between stability (5) and variance (2)
2025-10-27 08:17:39,263 - __main__ - WARNING -          → May indicate measurement artifact or convergence issues
2025-10-27 08:17:39,263 - analysis.mcmc_diagnostics - INFO - Creating rank plots for W (Factor Loadings)...
2025-10-27 08:17:39,281 - analysis.mcmc_diagnostics - INFO -   Plotting ranks for 4 parameters (out of 30 total)
2025-10-27 08:17:39,456 - analysis.mcmc_diagnostics - INFO -   ✓ Rank plots created successfully
2025-10-27 08:17:39,456 - analysis.mcmc_diagnostics - INFO - Creating rank plots for Z (Factor Scores)...
2025-10-27 08:17:39,473 - analysis.mcmc_diagnostics - INFO -   Plotting ranks for 4 parameters (out of 30 total)
2025-10-27 08:17:39,633 - analysis.mcmc_diagnostics - INFO -   ✓ Rank plots created successfully
2025-10-27 08:17:39,633 - __main__ - INFO - 📁 Using experiment output dir for plots: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2
2025-10-27 08:17:57,105 - core.io_utils - INFO - Saved 10 plots individually to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots (0 skipped)
2025-10-27 08:17:57,105 - core.io_utils - INFO -   Formats: png, pdf
2025-10-27 08:17:57,105 - __main__ - INFO - ✅ Saved 10 individual plots to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2/individual_plots
2025-10-27 08:17:57,105 - __main__ - INFO - ✅ Generated 10 plots
2025-10-27 08:17:57,105 - __main__ - INFO -    - factor_stability_summary
2025-10-27 08:17:57,105 - __main__ - INFO -    - enhanced_loading_distributions
2025-10-27 08:17:57,105 - __main__ - INFO -    - factor_stability_heatmap
2025-10-27 08:17:57,106 - __main__ - INFO -    - mcmc_trace_diagnostics
2025-10-27 08:17:57,106 - __main__ - INFO -    - mcmc_parameter_distributions
2025-10-27 08:17:57,106 - __main__ - INFO -    - hyperparameter_posteriors
2025-10-27 08:17:57,106 - __main__ - INFO -    - hyperparameter_traces
2025-10-27 08:17:57,106 - __main__ - INFO -    - factor_variance_profile
2025-10-27 08:17:57,106 - __main__ - INFO -    - rank_plot_W
2025-10-27 08:17:57,106 - __main__ - INFO -    - rank_plot_Z
2025-10-27 08:17:57,106 - __main__ - INFO - ================================================================================
2025-10-27 08:17:57,106 - __main__ - INFO - ================================================================================
2025-10-27 08:17:57,106 - __main__ - INFO - Summary:
2025-10-27 08:17:57,106 - __main__ - INFO -   - 4 chains completed
2025-10-27 08:17:57,106 - __main__ - INFO -   - 5/5 stable factors
2025-10-27 08:17:57,106 - __main__ - INFO -   - Stability rate: 100.0%
2025-10-27 08:17:57,106 - __main__ - INFO -   - Mean effective factors: 5.0
2025-10-27 08:17:57,106 - __main__ - INFO -   Convergence Diagnostics:
2025-10-27 08:17:57,106 - __main__ - INFO -     - R-hat (W, aligned) [PRIMARY]: max=6.7131, mean=4.1622 ⚠️ (0.4% < 1.1)
2025-10-27 08:17:57,106 - __main__ - INFO -     - R-hat (Z, aligned) [PRIMARY]: max=67.8177, mean=11.5556 ⚠️ (0.0% < 1.1)
2025-10-27 08:17:57,106 - __main__ - INFO -     [Raw R-hat for reference - may be high due to sign/rotation ambiguity]
2025-10-27 08:17:57,106 - __main__ - INFO -     - R-hat (W, raw): max=7.6298, mean=4.0489 ⚠️
2025-10-27 08:17:57,106 - __main__ - INFO -     - R-hat (Z, raw): max=65.8272, mean=11.1798 ⚠️
2025-10-27 08:17:57,106 - __main__ - INFO -   - 10 plots generated
2025-10-27 08:17:57,106 - __main__ - INFO - ================================================================================
2025-10-27 08:17:57,106 - __main__ - INFO - SAVING CONSENSUS FACTOR LOADINGS AND SCORES
2025-10-27 08:17:57,106 - __main__ - INFO - ================================================================================
2025-10-27 08:17:57,106 - __main__ - INFO - Saving to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2
2025-10-27 08:17:57,106 - __main__ - INFO - Extracting posterior geometry diagnostics...
2025-10-27 08:17:57,106 - __main__ - INFO -   ✅ Extracted posterior geometry diagnostics
2025-10-27 08:17:57,106 - analysis.factor_stability - INFO - Saving stability results to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251027_001201/factor_stability_fixed_K5_percW33_slab4_2
2025-10-27 08:17:57,119 - analysis.factor_stability - INFO -   ✅ Saved consensus factor loadings (W): (1808, 5)
2025-10-27 08:17:57,119 - analysis.factor_stability - INFO -   Saving per-view consensus loadings...
2025-10-27 08:17:57,127 - analysis.factor_stability - INFO -     ✅ Saved volume_sn_voxels loadings (W): (1794, 5)
2025-10-27 08:17:57,162 - analysis.factor_stability - INFO -     ✅ Saved SN Factor_0 reconstruction: 86 subjects × 1794 voxels
2025-10-27 08:17:57,199 - analysis.factor_stability - INFO -     ✅ Saved SN Factor_1 reconstruction: 86 subjects × 1794 voxels
2025-10-27 08:17:57,235 - analysis.factor_stability - INFO -     ✅ Saved SN Factor_2 reconstruction: 86 subjects × 1794 voxels
2025-10-27 08:17:57,271 - analysis.factor_stability - INFO -     ✅ Saved SN Factor_3 reconstruction: 86 subjects × 1794 voxels
2025-10-27 08:17:57,307 - analysis.factor_stability - INFO -     ✅ Saved SN Factor_4 reconstruction: 86 subjects × 1794 voxels
2025-10-27 08:17:57,308 - analysis.factor_stability - INFO -     ✅ Saved clinical loadings (W): (14, 5)
2025-10-27 08:17:57,311 - analysis.factor_stability - INFO -     ✅ Saved clinical Factor_0 reconstruction: 86 subjects × 14 features
2025-10-27 08:17:57,313 - analysis.factor_stability - INFO -     ✅ Saved clinical Factor_1 reconstruction: 86 subjects × 14 features
2025-10-27 08:17:57,315 - analysis.factor_stability - INFO -     ✅ Saved clinical Factor_2 reconstruction: 86 subjects × 14 features
2025-10-27 08:17:57,317 - analysis.factor_stability - INFO -     ✅ Saved clinical Factor_3 reconstruction: 86 subjects × 14 features
2025-10-27 08:17:57,319 - analysis.factor_stability - INFO -     ✅ Saved clinical Factor_4 reconstruction: 86 subjects × 14 features
2025-10-27 08:17:57,321 - analysis.factor_stability - INFO -   ✅ Saved consensus factor scores (Z median): (86, 5)
2025-10-27 08:17:57,323 - analysis.factor_stability - INFO -   ✅ Saved consensus Z posterior std: (86, 5)
2025-10-27 08:17:57,325 - analysis.factor_stability - INFO -   ✅ Saved consensus Z 2.5th percentile (lower 95% CI)
2025-10-27 08:17:57,326 - analysis.factor_stability - INFO -   ✅ Saved consensus Z 97.5th percentile (upper 95% CI)
2025-10-27 08:17:57,326 - analysis.factor_stability - INFO -   📊 Z posterior uncertainty quantified (Aspect 6: Z Indeterminacy)
2025-10-27 08:17:57,329 - analysis.factor_stability - INFO -   ✅ Saved similarity matrix: .npy and .csv formats
2025-10-27 08:17:57,329 - analysis.factor_stability - INFO -   Saving posterior geometry diagnostics...
2025-10-27 08:17:57,330 - analysis.factor_stability - INFO - Factor stability results saved successfully
2025-10-27 08:17:57,330 - __main__ - INFO - ✅ Consensus factor loadings and scores saved successfully
2025-10-27 08:17:57,330 - __main__ - INFO - Returning ExperimentResult object
