2025-10-28 13:38:59,564 - __main__ - INFO - ðŸ“ Comprehensive pipeline logging configured: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/experiments.log
2025-10-28 13:38:59,564 - __main__ - INFO -    All experiments will log to this single file
2025-10-28 13:38:59,566 - core.config_utils - INFO - Ensured output directory exists: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859
2025-10-28 13:38:59,567 - core.config_utils - INFO - Ensured checkpoint directory exists: results/checkpoints
2025-10-28 13:38:59,567 - __main__ - INFO -  Available devices: [cuda(id=0)]
2025-10-28 13:38:59,568 - __main__ - INFO -  GPU devices available for acceleration: [cuda(id=0)]
2025-10-28 13:38:59,572 - core.results_cache - INFO - ðŸ“¦ SGFA results cache initialized: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/.sgfa_cache
2025-10-28 13:38:59,572 - __main__ - INFO -  Starting Remote Workstation Experimental Framework at 2025-10-28 13:38:59.572769
2025-10-28 13:38:59,572 - __main__ - INFO -  Running experiments: ['all']
2025-10-28 13:38:59,572 - __main__ - INFO - â„¹ï¸  Running core analysis pipeline: data_validation â†’ factor_stability
2025-10-28 13:38:59,573 - __main__ - INFO - ðŸ”— Using SHARED DATA MODE - efficient pipeline with data reuse
2025-10-28 13:38:59,573 - __main__ - INFO - ðŸ”„ Pipeline context initialized (shared_mode: True)
2025-10-28 13:38:59,573 - __main__ - INFO - ðŸ” 1/2 Starting Data Validation Experiment...
2025-10-28 13:38:59,573 - experiments.data_validation - INFO - Starting Data Validation Experiments
2025-10-28 13:38:59,573 - experiments.data_validation - INFO - Running comprehensive data validation with EDA plots...
2025-10-28 13:38:59,573 - experiments.data_validation - INFO - ðŸ“ Using unified directory structure: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10
2025-10-28 13:38:59,575 - experiments.framework - INFO - ðŸ“ Log handler already exists for /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/experiments.log - skipping duplicate
2025-10-28 13:38:59,575 - experiments.framework - INFO - ExperimentFramework initialized with output dir: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859
2025-10-28 13:38:59,582 - experiments.framework - INFO - Starting experiment: data_validation_20251028_133859
2025-10-28 13:38:59,583 - experiments.data_validation - INFO - Running comprehensive data validation...
2025-10-28 13:38:59,583 - experiments.data_validation - INFO - Auto-configured system: 22.5GB memory limit
2025-10-28 13:38:59,586 - experiments.data_validation - INFO - ExperimentFramework initialized with output dir: results
2025-10-28 13:38:59,586 - experiments.data_validation - INFO - Auto-configured system: 22.5GB memory limit
2025-10-28 13:38:59,586 - experiments.data_validation - INFO - Memory optimizer initialized with 22.5GB limit
2025-10-28 13:38:59,586 - experiments.data_validation - INFO - Data streaming components initialized
2025-10-28 13:38:59,586 - experiments.data_validation - INFO - MCMC memory optimizer initialized
2025-10-28 13:38:59,586 - experiments.data_validation - INFO - Running data quality assessment
2025-10-28 13:38:59,586 - experiments.data_validation - INFO - Loading qMAP-PD data for quality assessment...
2025-10-28 13:38:59,586 - experiments.data_validation - INFO -    ROI selection: ['volume_sn_voxels.tsv']
2025-10-28 13:38:59,586 - experiments.data_validation - INFO -    Confound regression: ['age', 'sex', 'tiv']
2025-10-28 13:38:59,587 - experiments.data_validation - INFO -    Feature selection: none
2025-10-28 13:38:59,659 - root - INFO - Loading selected ROIs: ['volume_sn_voxels.tsv']
2025-10-28 13:38:59,846 - root - INFO - Regressing out confounds (before preprocessing): ['age', 'sex', 'tiv']
2025-10-28 13:38:59,910 - root - INFO -   Regressed confounds from volume_sn_voxels: ['age', 'sex', 'tiv']
2025-10-28 13:38:59,910 - root - INFO -   Dropped 3 confound features from clinical: ['age', 'sex', 'tiv']
2025-10-28 13:38:59,911 - root - INFO -   Remaining clinical features: 14
2025-10-28 13:38:59,911 - root - INFO - âœ… Confound regression complete (before preprocessing)
2025-10-28 13:38:59,931 - root - INFO - Preprocessing module imported successfully
2025-10-28 13:38:59,937 - experiments.data_validation - INFO -    PCA enabled in preprocessing_config: False
2025-10-28 13:38:59,948 - root - INFO - Loading selected ROIs: ['volume_sn_voxels.tsv']
2025-10-28 13:39:00,153 - root - INFO - Regressing out confounds (before preprocessing): ['age', 'sex', 'tiv']
2025-10-28 13:39:00,158 - root - INFO -   Regressed confounds from volume_sn_voxels: ['age', 'sex', 'tiv']
2025-10-28 13:39:00,159 - root - INFO -   Dropped 3 confound features from clinical: ['age', 'sex', 'tiv']
2025-10-28 13:39:00,159 - root - INFO -   Remaining clinical features: 14
2025-10-28 13:39:00,159 - root - INFO - âœ… Confound regression complete (before preprocessing)
2025-10-28 13:39:00,159 - root - INFO - Starting neuroimaging-aware preprocessing pipeline
2025-10-28 13:39:00,159 - root - INFO - MAD filtering disabled for volume_sn_voxels (threshold=None)
2025-10-28 13:39:00,189 - root - INFO - Applying none feature selection to volume_sn_voxels
2025-10-28 13:39:00,189 - root - INFO - Applying standard scaling to volume_sn_voxels
2025-10-28 13:39:00,193 - data.preprocessing - WARNING - âš ï¸  volume_sn_voxels standardization verification FAILED:
2025-10-28 13:39:00,193 - data.preprocessing - INFO -    âœ“ Mean: -0.000000
2025-10-28 13:39:00,193 - data.preprocessing - INFO -    âœ“ Std:  1.005865
2025-10-28 13:39:00,193 - data.preprocessing - WARNING -    âŒ Max:  7.85 (threshold: 5.0)
2025-10-28 13:39:00,193 - data.preprocessing - WARNING -       This suggests EXTREME outliers or non-standardized data!
2025-10-28 13:39:00,194 - data.preprocessing - WARNING -       SGFA horseshoe priors assume standardized inputs.
2025-10-28 13:39:00,195 - root - INFO - Applying none feature selection to clinical
2025-10-28 13:39:00,195 - root - INFO - Applying standard scaling to clinical
2025-10-28 13:39:00,197 - data.preprocessing - INFO - âœ… clinical standardization verified:
2025-10-28 13:39:00,197 - data.preprocessing - INFO -    Mean: 0.000000 (target: 0.0, tol: 0.1)
2025-10-28 13:39:00,197 - data.preprocessing - INFO -    Std:  1.005865 (target: 1.0, tol: 0.2)
2025-10-28 13:39:00,197 - data.preprocessing - INFO -    Max:  3.62 (threshold: 5.0)
2025-10-28 13:39:00,198 - experiments.data_validation - INFO -    âœ… Filtered position lookups saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/position_lookup_filtered
2025-10-28 13:39:00,198 - experiments.data_validation - INFO -    Creating filtered position lookups with output_dir: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10
2025-10-28 13:39:00,198 - experiments.data_validation - INFO -   _create_filtered_position_lookups called:
2025-10-28 13:39:00,198 - experiments.data_validation - INFO -     view_names: ['volume_sn_voxels', 'clinical']
2025-10-28 13:39:00,198 - experiments.data_validation - INFO -     n_views raw: 2, preprocessed: 2
2025-10-28 13:39:00,198 - experiments.data_validation - INFO -   Creating filtered position lookup for volume_sn_voxels...
2025-10-28 13:39:00,201 - experiments.data_validation - INFO -   Original positions: 1794 rows
2025-10-28 13:39:00,201 - experiments.data_validation - INFO -   Raw data: 1794 voxels
2025-10-28 13:39:00,201 - experiments.data_validation - INFO -   Preprocessed data: 1794 voxels
2025-10-28 13:39:00,202 - experiments.data_validation - INFO -   No voxels dropped, position lookup unchanged
2025-10-28 13:39:00,216 - experiments.data_validation - INFO -   âœ… Saved filtered position lookup: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/filtered_position_lookups/sn_filtered_position_lookup.csv
2025-10-28 13:39:00,216 - experiments.data_validation - INFO -      1794 â†’ 1794 rows
2025-10-28 13:39:00,216 - experiments.data_validation - INFO -   Skipping clinical view
2025-10-28 13:39:00,216 - experiments.data_validation - INFO -    âœ… Filtered position lookups saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/filtered_position_lookups
2025-10-28 13:39:00,217 - experiments.data_validation - INFO -    Files created: ['/cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/filtered_position_lookups/sn_filtered_position_lookup.csv']
2025-10-28 13:39:00,218 - experiments.data_validation - INFO - Data structure analysis completed. Raw: 1808 features, Processed: 1808 features
2025-10-28 13:39:00,218 - experiments.data_validation - INFO - ðŸ” Assessing data quality metrics...
2025-10-28 13:39:00,218 - experiments.data_validation - INFO -    Analyzing quality metrics for volume_sn_voxels (86Ã—1794)...
2025-10-28 13:39:00,225 - experiments.data_validation - INFO -    Analyzing quality metrics for clinical (86Ã—14)...
2025-10-28 13:39:00,226 - experiments.data_validation - INFO -       Computing correlation matrix for clinical...
2025-10-28 13:39:00,273 - experiments.data_validation - INFO -    Analyzing quality metrics for volume_sn_voxels (86Ã—1794)...
2025-10-28 13:39:00,280 - experiments.data_validation - INFO -    Analyzing quality metrics for clinical (86Ã—14)...
2025-10-28 13:39:00,280 - experiments.data_validation - INFO -       Computing correlation matrix for clinical...
2025-10-28 13:39:00,280 - experiments.data_validation - INFO - ðŸ“Š Estimating Signal-to-Noise Ratio (SNR)...
2025-10-28 13:39:00,280 - experiments.data_validation - INFO -    Analyzing SNR for volume_sn_voxels ((86, 1794))...
2025-10-28 13:39:00,393 - experiments.data_validation - INFO -       PCA SNR: 4.93 (signal=9 PCs)
2025-10-28 13:39:00,394 - experiments.data_validation - INFO -       Effective dim (95%): 21 PCs
2025-10-28 13:39:00,394 - experiments.data_validation - INFO -       Scree elbow at PC: 2
2025-10-28 13:39:00,396 - experiments.data_validation - INFO -       Variance SNR: 0.00
2025-10-28 13:39:00,399 - experiments.data_validation - INFO -       Feature SNR: median=0.00
2025-10-28 13:39:00,399 - experiments.data_validation - INFO -    ðŸ“‹ SNR Interpretation for volume_sn_voxels:
2025-10-28 13:39:00,400 - experiments.data_validation - INFO -       Signal quality: Moderate (SNR 3-10): Adequate signal, moderate noise
2025-10-28 13:39:00,400 - experiments.data_validation - INFO -       Recommended K: 2-2 (moderate signal)
2025-10-28 13:39:00,400 - experiments.data_validation - INFO -       Prior strength: MODERATE priors (SNR 2-5): Use Ï„â‚€ floor (current: 0.3)
2025-10-28 13:39:00,401 - experiments.data_validation - INFO -       Convergence: MODERATE: May need longer chains or stronger priors
2025-10-28 13:39:00,401 - experiments.data_validation - INFO -    Analyzing SNR for clinical ((86, 14))...
2025-10-28 13:39:00,402 - experiments.data_validation - INFO -       PCA SNR: 14.65 (signal=9 PCs)
2025-10-28 13:39:00,404 - experiments.data_validation - INFO -       Effective dim (95%): 10 PCs
2025-10-28 13:39:00,404 - experiments.data_validation - INFO -       Scree elbow at PC: 2
2025-10-28 13:39:00,405 - experiments.data_validation - INFO -       Variance SNR: 0.00
2025-10-28 13:39:00,406 - experiments.data_validation - INFO -       Feature SNR: median=0.00
2025-10-28 13:39:00,406 - experiments.data_validation - INFO -    ðŸ“‹ SNR Interpretation for clinical:
2025-10-28 13:39:00,407 - experiments.data_validation - INFO -       Signal quality: High (SNR > 10): Strong signal, low noise
2025-10-28 13:39:00,407 - experiments.data_validation - INFO -       Recommended K: 2-8 (signal supports more factors)
2025-10-28 13:39:00,407 - experiments.data_validation - INFO -       Prior strength: WEAK priors ok (SNR > 5): Data-dependent Ï„â‚€ may suffice
2025-10-28 13:39:00,408 - experiments.data_validation - INFO -       Convergence: GOOD: High SNR + well-defined subspace
2025-10-28 13:39:00,408 - experiments.data_validation - INFO - âœ… SNR estimation complete for all views
2025-10-28 13:39:00,439 - experiments.data_validation - INFO - ================================================================================
2025-10-28 13:39:00,443 - experiments.data_validation - INFO - ðŸ” MAD THRESHOLD EXPLORATORY DATA ANALYSIS
2025-10-28 13:39:00,443 - experiments.data_validation - INFO - ================================================================================
2025-10-28 13:39:00,444 - experiments.data_validation - INFO - Analyzing optimal MAD threshold values for outlier detection...
2025-10-28 13:39:00,444 - experiments.data_validation - INFO - Analyzing 1 imaging views: ['volume_sn_voxels']
2025-10-28 13:39:00,444 - experiments.data_validation - INFO - ðŸ“Š Analyzing MAD distributions...
2025-10-28 13:39:00,444 - experiments.data_validation - INFO -    Processing volume_sn_voxels: (86, 1794)
2025-10-28 13:39:01,475 - experiments.data_validation - INFO -       Saved MAD distribution plot: mad_distribution_sn.png
2025-10-28 13:39:01,475 - experiments.data_validation - INFO -    âœ… MAD distributions analyzed for 1 views
2025-10-28 13:39:01,475 - experiments.data_validation - INFO - ðŸ“ˆ Performing elbow analysis...
2025-10-28 13:39:01,487 - experiments.data_validation - INFO -    volume_sn_voxels: Elbow at 2.26 (7.1% retention)
2025-10-28 13:39:01,896 - experiments.data_validation - INFO -    âœ… Elbow analysis completed, saved to elbow_analysis_all_views.png
2025-10-28 13:39:01,896 - experiments.data_validation - INFO - ðŸ—ºï¸  Analyzing spatial distribution of removed voxels...
2025-10-28 13:39:01,898 - experiments.data_validation - INFO -    Loaded position lookup for volume_sn_voxels: 1794 voxels
2025-10-28 13:39:03,068 - experiments.data_validation - INFO -       Saved spatial distribution plot: spatial_distribution_sn.png
2025-10-28 13:39:03,069 - experiments.data_validation - INFO -    âœ… Spatial analysis completed for 1 views
2025-10-28 13:39:03,069 - experiments.data_validation - INFO - ðŸ“Š Analyzing information preservation...
2025-10-28 13:39:03,069 - experiments.data_validation - INFO -    Processing volume_sn_voxels...
2025-10-28 13:39:03,638 - experiments.data_validation - INFO -       Saved information preservation plot: information_preservation_all_views.png
2025-10-28 13:39:03,638 - experiments.data_validation - INFO -    âœ… Information preservation analyzed for 1 views
2025-10-28 13:39:03,638 - experiments.data_validation - INFO - ðŸ‘¤ Analyzing subject-level data quality...
2025-10-28 13:39:03,638 - experiments.data_validation - INFO -    Processing volume_sn_voxels: (86, 1794)
2025-10-28 13:39:03,904 - experiments.data_validation - INFO -       Mean outlier %: 1.1%
2025-10-28 13:39:03,904 - experiments.data_validation - INFO -       Max outlier %: 17.5%
2025-10-28 13:39:04,386 - experiments.data_validation - INFO -       Saved subject outlier distribution plot: subject_outlier_distributions.png
2025-10-28 13:39:04,389 - experiments.data_validation - INFO -       Saved flagged subjects table: flagged_subjects.csv (2 subjects)
2025-10-28 13:39:04,391 - experiments.data_validation - INFO -       Saved flagged subjects report: flagged_subjects_report.txt
2025-10-28 13:39:04,776 - experiments.data_validation - INFO -       Saved subject outlier comparison plot: subject_outlier_comparison.png
2025-10-28 13:39:05,287 - experiments.data_validation - INFO -       Saved subject outlier scatter plot: subject_outlier_scatter.png
2025-10-28 13:39:05,955 - experiments.data_validation - INFO -       Saved top subjects bar chart: subject_outlier_top20.png
2025-10-28 13:39:05,955 - experiments.data_validation - INFO -    âœ… Subject-level analysis completed: 2 subjects flagged
2025-10-28 13:39:05,955 - experiments.data_validation - INFO - ðŸ“‹ Generating threshold comparison summary...
2025-10-28 13:39:05,958 - experiments.data_validation - INFO -    Saved summary table: mad_threshold_summary_table.csv
2025-10-28 13:39:05,960 - experiments.data_validation - INFO -    ðŸ“ Saved recommendations: mad_threshold_recommendations.txt
2025-10-28 13:39:05,960 - experiments.data_validation - INFO - ================================================================================
2025-10-28 13:39:05,960 - experiments.data_validation - INFO - âœ… MAD threshold EDA completed successfully
2025-10-28 13:39:05,960 - experiments.data_validation - INFO - ================================================================================
2025-10-28 13:39:05,961 - experiments.data_validation - INFO - ðŸ“Š Generating data validation plots...
2025-10-28 13:39:05,961 - experiments.data_validation - INFO -    Creating distribution histograms for 1 clinical view(s), skipping 1 imaging views
2025-10-28 13:39:06,089 - experiments.data_validation - INFO -    âœ… Distribution histograms created (stored as data_distribution_comparison)
2025-10-28 13:39:06,096 - experiments.data_validation - INFO - ðŸ“Š Basic data validation plots completed: 1 plots generated
2025-10-28 13:39:06,096 - experiments.data_validation - INFO - ðŸŽ¨ Creating comprehensive data validation visualizations for data_quality_assessment
2025-10-28 13:39:06,106 - visualization.preprocessing_plots - INFO - Creating preprocessing plots
2025-10-28 13:39:06,110 - visualization.covariance_plots - INFO - ================================================================================
2025-10-28 13:39:06,111 - visualization.covariance_plots - INFO - COVARIANCE STRUCTURE ANALYSIS
2025-10-28 13:39:06,111 - visualization.covariance_plots - INFO - ================================================================================
2025-10-28 13:39:06,225 - visualization.covariance_plots - INFO - Intra-modality covariance for volume_sn_voxels: 1794x1794
2025-10-28 13:39:06,226 - visualization.covariance_plots - INFO - Intra-modality covariance for clinical: 14x14
2025-10-28 13:39:06,286 - visualization.covariance_plots - INFO - Inter-modality covariance for volume_sn_voxels_vs_clinical: 1794x14
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO - 
Data structure:
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -   Number of views: 2
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -   Number of samples: 86
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -   volume_sn_voxels: 1794 features
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -   clinical: 14 features
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO - 
Intra-modality correlation statistics:
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -   volume_sn_voxels:
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Mean correlation: 0.388
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Std correlation: 0.219
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Max |correlation|: 0.994
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -   clinical:
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Mean correlation: 0.073
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Std correlation: 0.350
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Max |correlation|: 0.911
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO - 
Inter-modality correlation statistics:
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -   volume_sn_voxels_vs_clinical:
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Mean correlation: 0.031
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Std correlation: 0.121
2025-10-28 13:39:06,388 - visualization.covariance_plots - INFO -     Max |correlation|: 0.371
2025-10-28 13:39:06,389 - visualization.covariance_plots - INFO - 
Generating covariance plots...
2025-10-28 13:39:06,389 - visualization.covariance_plots - INFO - Subsampling covariance matrix from 1808 to 500 features
2025-10-28 13:39:07,674 - visualization.covariance_plots - INFO - Saved block covariance matrix plot to results/plots/block_covariance_matrix.png
2025-10-28 13:39:16,238 - visualization.covariance_plots - INFO - Saved inter/intra comparison plot to results/plots/inter_vs_intra_correlation.png
2025-10-28 13:39:16,238 - visualization.covariance_plots - INFO - Plots saved to results/plots
2025-10-28 13:39:16,239 - visualization.covariance_plots - INFO - ================================================================================
2025-10-28 13:39:16,248 - experiments.data_validation - INFO -    Found 2 plot files to convert
2025-10-28 13:39:16,716 - experiments.data_validation - INFO -    âœ… Created 2 comprehensive data validation visualizations
2025-10-28 13:39:16,716 - experiments.data_validation - INFO - ðŸŽ¨ Comprehensive data validation plots completed: 2 advanced plots generated
2025-10-28 13:39:16,716 - experiments.data_validation - INFO - ðŸ“Š Creating SNR analysis plots...
2025-10-28 13:39:16,716 - experiments.data_validation - INFO - ðŸ“Š Creating SNR analysis visualizations...
2025-10-28 13:39:16,716 - experiments.data_validation - INFO -    Generating 3-panel SNR plot for volume_sn_voxels...
2025-10-28 13:39:16,976 - experiments.data_validation - INFO -       âœ… Created SNR plot: snr_analysis_volume_sn_voxels.png
2025-10-28 13:39:16,977 - experiments.data_validation - INFO -    Generating 3-panel SNR plot for clinical...
2025-10-28 13:39:17,006 - experiments.data_validation - INFO -       âœ… Created SNR plot: snr_analysis_clinical.png
2025-10-28 13:39:17,006 - experiments.data_validation - INFO - âœ… Generated 2 SNR visualization(s)
2025-10-28 13:39:17,006 - experiments.data_validation - INFO - ðŸ“Š Total plots ready for saving: 5
2025-10-28 13:39:17,007 - experiments.data_validation - INFO - ðŸ“ Using experiment output dir: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10
2025-10-28 13:39:25,470 - core.io_utils - INFO - Saved 5 plots individually to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/individual_plots (0 skipped)
2025-10-28 13:39:25,470 - core.io_utils - INFO -   Formats: png, pdf
2025-10-28 13:39:25,470 - experiments.data_validation - INFO - âœ… Saved 5 individual plots to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/individual_plots
2025-10-28 13:39:25,470 - experiments.data_validation - INFO - ðŸ“Š Saving SNR analysis results...
2025-10-28 13:39:25,470 - experiments.data_validation - INFO - ðŸ“Š Saving SNR analysis results...
2025-10-28 13:39:25,473 - experiments.data_validation - INFO -    âœ… Saved SNR text report: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/snr_analysis/snr_report.txt
2025-10-28 13:39:25,473 - experiments.data_validation - INFO - âœ… SNR results saved successfully
2025-10-28 13:39:25,473 - experiments.data_validation - INFO - âœ… Data validation with EDA completed!
2025-10-28 13:39:25,473 - experiments.data_validation - INFO -    Plots generated: 5
2025-10-28 13:39:25,474 - experiments.framework - INFO - ðŸ EXPERIMENT COMPLETED: data_validation_20251028_133859
2025-10-28 13:39:25,474 - experiments.framework - INFO - â±ï¸  TOTAL RUNTIME: 25.9 seconds
2025-10-28 13:39:25,474 - experiments.framework - INFO - ðŸ• Started: 2025-10-28 13:38:59
2025-10-28 13:39:25,474 - experiments.framework - INFO - ðŸ•‘ Finished: 2025-10-28 13:39:25
2025-10-28 13:39:25,474 - experiments.framework - INFO - Experiment completed successfully: data_validation_20251028_133859
2025-10-28 13:39:25,474 - experiments.framework - INFO - ðŸ§¹ Performing comprehensive memory cleanup...
2025-10-28 13:39:25,567 - experiments.framework - INFO - Garbage collection freed 4835 objects
2025-10-28 13:39:25,899 - experiments.framework - INFO - GPU memory cleanup attempted
2025-10-28 13:39:26,900 - experiments.framework - INFO - âœ… Comprehensive memory cleanup completed
2025-10-28 13:39:27,192 - experiments.framework - INFO - Pickle saving disabled to prevent large files - using JSON and CSV instead
2025-10-28 13:39:27,198 - experiments.framework - INFO - Saving 5 plots to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/plots
2025-10-28 13:39:27,901 - experiments.framework - WARNING - Failed to save plot data_distribution_comparison: name 'plt' is not defined
2025-10-28 13:39:28,610 - experiments.framework - WARNING - Failed to save plot data_validation_block_covariance_matrix: name 'plt' is not defined
2025-10-28 13:39:29,317 - experiments.framework - WARNING - Failed to save plot data_validation_inter_vs_intra_correlation: name 'plt' is not defined
2025-10-28 13:39:30,024 - experiments.framework - WARNING - Failed to save plot snr_analysis_volume_sn_voxels: name 'plt' is not defined
2025-10-28 13:39:30,729 - experiments.framework - WARNING - Failed to save plot snr_analysis_clinical: name 'plt' is not defined
2025-10-28 13:39:30,729 - experiments.framework - INFO - All plots saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/01_data_validation_fixed_K5_percW33_slab4_2_tree10/plots
2025-10-28 13:39:30,729 - experiments.data_validation - INFO - âœ… Data validation completed successfully
2025-10-28 13:39:30,841 - experiments.data_validation - INFO - ðŸ§¹ Memory cleanup completed
2025-10-28 13:39:30,841 - __main__ - INFO - ðŸ“Š Data validation loaded data: 2 views
2025-10-28 13:39:30,841 - __main__ - INFO -    Strategy: unknown
2025-10-28 13:39:30,841 - __main__ - INFO - ================================================================================
2025-10-28 13:39:30,841 - __main__ - INFO - ðŸ”¬ 3/4 STARTING FACTOR STABILITY ANALYSIS
2025-10-28 13:39:30,841 - __main__ - INFO - ================================================================================
2025-10-28 13:39:30,841 - __main__ - INFO -    â†’ Using shared data from previous experiments
2025-10-28 13:39:30,841 - __main__ - INFO -    â†’ X_list: 2 views
2025-10-28 13:39:30,841 - __main__ - INFO -       View 0: (86, 1794)
2025-10-28 13:39:30,841 - __main__ - INFO -       View 1: (86, 14)
2025-10-28 13:39:30,842 - __main__ - INFO -    Factor stability config from config.yaml: K=20, percW=None, num_chains=4
2025-10-28 13:39:30,842 - __main__ - INFO -    Using command-line K override: 5 (config.yaml has 20)
2025-10-28 13:39:30,842 - __main__ - INFO - Auto-configured system: 21.7GB memory limit
2025-10-28 13:39:30,845 - __main__ - INFO - ðŸ“ Log handler already exists for results/experiments.log - skipping duplicate
2025-10-28 13:39:30,845 - __main__ - INFO - ExperimentFramework initialized with output dir: results
2025-10-28 13:39:30,845 - __main__ - INFO - Auto-configured system: 21.7GB memory limit
2025-10-28 13:39:30,845 - __main__ - INFO - Memory optimizer initialized with 21.7GB limit
2025-10-28 13:39:30,845 - __main__ - INFO - Data streaming components initialized
2025-10-28 13:39:30,845 - __main__ - INFO - MCMC memory optimizer initialized
2025-10-28 13:39:30,846 - __main__ - INFO - ðŸ“ Set base_output_dir to run directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859
2025-10-28 13:39:30,846 - __main__ - INFO - ðŸ“ Created factor_stability experiment directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10
2025-10-28 13:39:30,846 - __main__ - INFO -    Using shared data: 2 views
2025-10-28 13:39:30,846 - __main__ - INFO -    Views: ['volume_sn_voxels', 'clinical']
2025-10-28 13:39:30,847 - __main__ - INFO -    Using global model hyperparameters: percW=33, slab_df=4, slab_scale=2
2025-10-28 13:39:30,847 - __main__ - INFO -    Detected 2 data views/sources from X_list
2025-10-28 13:39:30,847 - __main__ - INFO -    Using parameters from config.yaml:
2025-10-28 13:39:30,847 - __main__ - INFO -    - K=5, percW=33, slab_df=4, slab_scale=2
2025-10-28 13:39:30,847 - __main__ - INFO -    - num_samples=10000, num_warmup=3000
2025-10-28 13:39:30,847 - __main__ - INFO -    - target_accept_prob=0.8, max_tree_depth=10, dense_mass=False
2025-10-28 13:39:30,847 - __main__ - INFO -    - cosine_threshold=0.8, min_match_rate=0.5
2025-10-28 13:39:30,847 - __main__ - INFO -    Running 4 chains with K=5 factors...
2025-10-28 13:39:30,847 - __main__ - INFO -    This will take approximately 40 minutes
2025-10-28 13:39:30,847 - __main__ - INFO - ðŸ“ Experiment output directory set to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10
2025-10-28 13:39:30,849 - __main__ - INFO - ðŸ“ Using unified pipeline logging: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/experiments.log
2025-10-28 13:39:30,849 - __main__ - INFO -    Skipping experiment-specific log file creation
2025-10-28 13:39:30,849 - __main__ - INFO - ================================================================================
2025-10-28 13:39:30,849 - __main__ - INFO - FACTOR STABILITY ANALYSIS - STARTING
2025-10-28 13:39:30,849 - __main__ - INFO - ================================================================================
2025-10-28 13:39:30,849 - __main__ - INFO - Output directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10
2025-10-28 13:39:30,849 - __main__ - INFO - Running factor stability analysis with 4 independent chains
2025-10-28 13:39:30,849 - __main__ - INFO - Cosine similarity threshold: 0.8
2025-10-28 13:39:30,849 - __main__ - INFO - Minimum match rate: 0.5
2025-10-28 13:39:30,849 - __main__ - INFO - View names: ['volume_sn_voxels', 'clinical']
2025-10-28 13:39:30,849 - __main__ - INFO - Feature counts per view: {'volume_sn_voxels': 1794, 'clinical': 14}
2025-10-28 13:39:30,859 - __main__ - INFO - ================================================================================
2025-10-28 13:39:30,859 - __main__ - INFO - RUNNING 4 CHAINS WITH METHOD: parallel
2025-10-28 13:39:30,860 - __main__ - INFO - ================================================================================
2025-10-28 13:39:32,572 - __main__ - INFO - Base seed: 42
2025-10-28 13:39:32,572 - __main__ - INFO - MCMC config: samples=10000, warmup=3000, chains=4
2025-10-28 13:39:32,572 - __main__ - INFO - JAX will automatically split PRNG key for independent chains
2025-10-28 13:39:32,572 - __main__ - INFO - Chain RNG keys computed via fold_in for reproducibility
2025-10-28 13:39:32,688 - __main__ - INFO - Starting SGFA analysis with 4 chains...
2025-10-28 13:39:32,688 - __main__ - INFO - ðŸ”¬ Factor stability mode: Capturing full posterior geometry diagnostics
2025-10-28 13:39:32,688 - __main__ - INFO - ================================================================================
2025-10-28 13:39:32,688 - __main__ - INFO - _RUN_SGFA_ANALYSIS - STARTING
2025-10-28 13:39:32,688 - __main__ - INFO - ================================================================================
2025-10-28 13:39:32,689 - __main__ - INFO - Running SGFA: K=5, n_subjects=86, n_features=1808
2025-10-28 13:39:32,733 - models.models_integration - INFO -    Total features: 1,808
2025-10-28 13:39:32,733 - models.models_integration - INFO -    Views: 2
2025-10-28 13:39:32,733 - models.models_integration - INFO -    Subjects: 86
2025-10-28 13:39:32,733 - models.models_integration - INFO -    Has imaging data: True
2025-10-28 13:39:32,733 - models.models_integration - INFO - âœ… Selected model type: sparse_gfa_fixed
2025-10-28 13:39:32,733 - models.models_integration - INFO - ðŸ—ï¸ Creating model instance: sparse_gfa_fixed
2025-10-28 13:39:32,733 - models.models_integration - INFO -    Factory method: True
2025-10-28 13:39:32,733 - models.models_integration - INFO -  Model type: sparse_gfa_fixed
2025-10-28 13:39:32,734 - models.models_integration - INFO -  Model factory: True
2025-10-28 13:39:32,734 - models.models_integration - INFO -  Structured management: True
2025-10-28 13:39:32,734 - __main__ - INFO - MCMC configuration: warmup=3000, samples=10000, chains=4
2025-10-28 13:39:32,734 - __main__ - INFO - NUTS kernel parameters: target_accept_prob=0.8, max_tree_depth=10, dense_mass=False
2025-10-28 13:39:32,735 - __main__ - INFO - Creating MCMC sampler with chain_method=parallel...
2025-10-28 13:39:32,735 - __main__ - WARNING - âš ï¸  Running chains in explicit sequential mode with JAX cache clearing to prevent OOM
2025-10-28 13:39:32,735 - __main__ - WARNING -     (NumPyro's default chain execution can cause GPU memory accumulation)
2025-10-28 13:39:32,736 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-28 13:39:32,736 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-28 13:39:32,736 - __main__ - INFO -       Using init_params: False
2025-10-28 15:10:09,170 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-28 15:10:09,171 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-28 15:10:09,171 - __main__ - INFO -      View 1 (volume_sn_voxels): Ï„â‚€_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-28 15:10:09,171 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-28 15:10:09,172 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 314047232.000000 Â± 628094400.000000
2025-10-28 15:10:09,172 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 4265057280.000000 Â± 512.000000
2025-10-28 15:10:09,172 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.000684 Â± 0.000001
2025-10-28 15:10:09,172 - __main__ - INFO -       c_W (slab scale, loadings): 1.590961
2025-10-28 15:10:09,173 - __main__ - INFO -       c_Z (slab scale, factors): 1.104119
2025-10-28 15:10:13,868 - __main__ - INFO - âœ… Chain 1 cleanup complete
2025-10-28 15:10:25,390 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-28 15:10:25,391 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-28 15:10:25,391 - __main__ - INFO -       Using init_params: False
2025-10-28 16:40:52,012 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-28 16:40:52,013 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-28 16:40:52,014 - __main__ - INFO -      View 1 (volume_sn_voxels): Ï„â‚€_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-28 16:40:52,014 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-28 16:40:52,014 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 0.065968 Â± 0.059467
2025-10-28 16:40:52,015 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 640.393372 Â± 8.938732
2025-10-28 16:40:52,015 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.092302 Â± 0.003854
2025-10-28 16:40:52,015 - __main__ - INFO -       c_W (slab scale, loadings): 7.481374
2025-10-28 16:40:52,016 - __main__ - INFO -       c_Z (slab scale, factors): 2.233123
2025-10-28 16:40:56,697 - __main__ - INFO - âœ… Chain 2 cleanup complete
2025-10-28 16:41:08,217 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-28 16:41:08,217 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-28 16:41:08,217 - __main__ - INFO -       Using init_params: False
2025-10-28 18:11:36,219 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-28 18:11:36,219 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-28 18:11:36,220 - __main__ - INFO -      View 1 (volume_sn_voxels): Ï„â‚€_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-28 18:11:36,220 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-28 18:11:36,221 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 0.073358 Â± 0.044457
2025-10-28 18:11:36,221 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 117.354935 Â± 8.420810
2025-10-28 18:11:36,221 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.023246 Â± 0.026261
2025-10-28 18:11:36,222 - __main__ - INFO -       c_W (slab scale, loadings): 9.153316
2025-10-28 18:11:36,222 - __main__ - INFO -       c_Z (slab scale, factors): 2.716211
2025-10-28 18:11:40,882 - __main__ - INFO - âœ… Chain 3 cleanup complete
2025-10-28 18:11:52,399 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-28 18:11:52,399 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-28 18:11:52,399 - __main__ - INFO -       Using init_params: False
2025-10-28 19:42:19,397 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-28 19:42:19,398 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-28 19:42:19,398 - __main__ - INFO -      View 1 (volume_sn_voxels): Ï„â‚€_W = 0.300000 | D = 1794 features (high-D (>200), floor=0.3)
2025-10-28 19:42:19,398 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-28 19:42:19,399 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 0.073953 Â± 0.043455
2025-10-28 19:42:19,399 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 45.271061 Â± 0.336023
2025-10-28 19:42:19,399 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.160111 Â± 0.002023
2025-10-28 19:42:19,400 - __main__ - INFO -       c_W (slab scale, loadings): 4.018110
2025-10-28 19:42:19,400 - __main__ - INFO -       c_Z (slab scale, factors): 2.053295
2025-10-28 19:42:24,090 - __main__ - INFO - âœ… Chain 4 cleanup complete
2025-10-28 19:42:24,411 - __main__ - INFO - Got samples grouped by chain: 4 chains
2025-10-28 19:42:24,411 - __main__ - INFO - Stored full samples for 4 chains for MCMC diagnostics
2025-10-28 19:42:24,411 - __main__ - INFO - W_samples shape: (4, 10000, 1808, 5)
2025-10-28 19:42:24,411 - __main__ - INFO - Z_samples shape: (4, 10000, 86, 5)
2025-10-28 19:42:24,411 - __main__ - INFO -    Result keys: ['W_samples', 'Z_samples', 'samples', 'n_iterations', 'num_chains', 'convergence', 'execution_time', 'robustness_info']
2025-10-28 19:42:24,412 - __main__ - INFO - âœ… All 4 chains completed successfully
2025-10-28 19:42:24,510 - optimization.profiler - INFO - Performance: all_chains: 21771.724s, 9.53GB peak, 100.1% CPU
2025-10-28 19:42:24,510 - __main__ - INFO - ================================================================================
2025-10-28 19:42:24,510 - __main__ - INFO - EXTRACTING POSTERIOR GEOMETRY DIAGNOSTICS
2025-10-28 19:42:24,510 - __main__ - INFO - ================================================================================
2025-10-28 19:42:24,510 - __main__ - INFO -   âœ… Extracted posterior geometry diagnostics
2025-10-28 19:42:24,510 - __main__ - INFO - W_samples shape: (4, 10000, 1808, 5)
2025-10-28 19:42:24,510 - __main__ - INFO - Z_samples shape: (4, 10000, 86, 5)
2025-10-28 19:42:24,510 - __main__ - INFO - ================================================================================
2025-10-28 19:42:24,510 - __main__ - INFO - VALIDATING MCMC SAMPLES (NaN/Inf CHECK)
2025-10-28 19:42:24,510 - __main__ - INFO - ================================================================================
2025-10-28 19:42:25,058 - __main__ - INFO - W (factor loadings) validation:
2025-10-28 19:42:25,059 - __main__ - INFO -   Total elements: 361,600,000
2025-10-28 19:42:25,059 - __main__ - INFO -   NaN values: 0 (0.0000%)
2025-10-28 19:42:25,059 - __main__ - INFO -   Inf values: 0 (0.0000%)
2025-10-28 19:42:25,059 - __main__ - INFO -   âœ“ All W samples are valid (finite)
2025-10-28 19:42:25,084 - __main__ - INFO - Z (factor scores) validation:
2025-10-28 19:42:25,085 - __main__ - INFO -   Total elements: 17,200,000
2025-10-28 19:42:25,085 - __main__ - INFO -   NaN values: 0 (0.0000%)
2025-10-28 19:42:25,085 - __main__ - INFO -   Inf values: 0 (0.0000%)
2025-10-28 19:42:25,085 - __main__ - INFO -   âœ“ All Z samples are valid (finite)
2025-10-28 19:42:25,085 - __main__ - INFO - ================================================================================
2025-10-28 19:42:25,085 - __main__ - INFO - âœ“ SAMPLE VALIDATION PASSED - All samples are valid
2025-10-28 19:42:25,085 - __main__ - INFO - ================================================================================
2025-10-28 19:42:25,085 - __main__ - INFO - Processing chain 1/4...
2025-10-28 19:42:25,115 - __main__ - INFO - Chain 0 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-28 19:42:25,115 - __main__ - INFO - Processing chain 2/4...
2025-10-28 19:42:25,145 - __main__ - INFO - Chain 1 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-28 19:42:25,145 - __main__ - INFO - Processing chain 3/4...
2025-10-28 19:42:25,175 - __main__ - INFO - Chain 2 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-28 19:42:25,175 - __main__ - INFO - Processing chain 4/4...
2025-10-28 19:42:25,206 - __main__ - INFO - Chain 3 processed: W shape: (1794, 5), Z shape: (86, 5)
2025-10-28 19:42:25,206 - __main__ - INFO - âœ… All chains completed in 21771.7s (362.9 min)
2025-10-28 19:42:25,206 - __main__ - INFO - ================================================================================
2025-10-28 19:42:25,206 - __main__ - INFO - ASSESSING FACTOR STABILITY ACROSS CHAINS
2025-10-28 19:42:25,206 - __main__ - INFO - ================================================================================
2025-10-28 19:42:25,206 - __main__ - INFO - Number of chains to analyze: 4
2025-10-28 19:42:25,206 - __main__ - INFO - Cosine threshold: 0.8
2025-10-28 19:42:25,206 - __main__ - INFO - Min match rate: 0.5
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - ================================================================================
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - ASSESS_FACTOR_STABILITY_COSINE - STARTING
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - ================================================================================
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Number of chains: 4
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Similarity threshold: 0.8
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Min match rate: 0.5
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Chain 0: W type=<class 'list'>, samples=True
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Chain 1: W type=<class 'list'>, samples=True
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Chain 2: W type=<class 'list'>, samples=True
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Chain 3: W type=<class 'list'>, samples=True
2025-10-28 19:42:25,206 - analysis.factor_stability - INFO - Chain 0: Averaging 10000 posterior samples
2025-10-28 19:42:25,234 - analysis.factor_stability - INFO - Chain 0: Averaged W samples -> shape (1808, 5)
2025-10-28 19:42:25,235 - analysis.factor_stability - INFO - Chain 1: Averaging 10000 posterior samples
2025-10-28 19:42:25,263 - analysis.factor_stability - INFO - Chain 1: Averaged W samples -> shape (1808, 5)
2025-10-28 19:42:25,263 - analysis.factor_stability - INFO - Chain 2: Averaging 10000 posterior samples
2025-10-28 19:42:25,291 - analysis.factor_stability - INFO - Chain 2: Averaged W samples -> shape (1808, 5)
2025-10-28 19:42:25,291 - analysis.factor_stability - INFO - Chain 3: Averaging 10000 posterior samples
2025-10-28 19:42:25,320 - analysis.factor_stability - INFO - Chain 3: Averaged W samples -> shape (1808, 5)
2025-10-28 19:42:25,320 - analysis.factor_stability - INFO - Factor loading matrices: D=1808 features, K=5 factors
2025-10-28 19:42:25,322 - analysis.factor_stability - INFO - Chain 0: Averaged Z shape (86, 5)
2025-10-28 19:42:25,323 - analysis.factor_stability - INFO - Chain 1: Averaged Z shape (86, 5)
2025-10-28 19:42:25,325 - analysis.factor_stability - INFO - Chain 2: Averaged Z shape (86, 5)
2025-10-28 19:42:25,327 - analysis.factor_stability - INFO - Chain 3: Averaged Z shape (86, 5)
2025-10-28 19:42:25,327 - analysis.factor_stability - INFO - Step 2: Matching 5 factors across 4 chains
2025-10-28 19:42:25,327 - analysis.factor_stability - INFO -   Using sign-invariant cosine similarity (handles factor sign flips)
2025-10-28 19:42:25,327 - analysis.factor_stability - INFO -   Zero-vector detection enabled (threshold: 1e-10)
2025-10-28 19:42:25,327 - analysis.factor_stability - INFO -   Processing factor 0/5
2025-10-28 19:42:25,328 - analysis.factor_stability - INFO - Factor 0: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-28 19:42:25,329 - analysis.factor_stability - INFO - Factor 1: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-28 19:42:25,330 - analysis.factor_stability - INFO - Factor 2: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-28 19:42:25,331 - analysis.factor_stability - INFO - Factor 3: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-28 19:42:25,331 - analysis.factor_stability - INFO - Factor 4: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-28 19:42:25,331 - analysis.factor_stability - INFO - 
ðŸ“Š Cosine Similarity Edge Case Summary:
2025-10-28 19:42:25,332 - analysis.factor_stability - INFO -   Zero reference vectors encountered: 0
2025-10-28 19:42:25,332 - analysis.factor_stability - INFO -   Zero comparison vectors encountered: 0
2025-10-28 19:42:25,332 - analysis.factor_stability - INFO -   Sign flips detected (|sim_raw| < -0.5): 0
2025-10-28 19:42:25,332 - analysis.factor_stability - INFO -   Total factor comparisons: 75
2025-10-28 19:42:25,332 - analysis.factor_stability - INFO - Computing consensus loadings for all 5 factors
2025-10-28 19:42:25,332 - analysis.factor_stability - INFO -   (Stable factors: 5/5)
2025-10-28 19:42:25,333 - analysis.factor_stability - INFO - Computing consensus scores for all 5 factors
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO - Consensus Z computed with uncertainty quantification
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   Median Z: shape (86, 5)
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   Mean std per subject: 0.468
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   Max std per subject: 1.953
2025-10-28 19:42:25,335 - analysis.factor_stability - WARNING -   âš ï¸  20 subjects have high uncertainty (>95th percentile)
2025-10-28 19:42:25,335 - analysis.factor_stability - WARNING -      Consider: More chains, longer sampling, or model issues
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO - ================================================================================
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO - ASSESS_FACTOR_STABILITY_COSINE - COMPLETED
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO - ================================================================================
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO - Results:
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   - Stable factors: 5/5
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   - Stability rate: 100.0%
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   - Stable factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   - Consensus W shape: (1808, 5)
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   - Consensus Z shape: (86, 5)
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO -   - Z posterior uncertainty quantified (std, CI)
2025-10-28 19:42:25,335 - analysis.factor_stability - INFO - Factor stability analysis complete:
2025-10-28 19:42:25,336 - analysis.factor_stability - INFO -   - 5/5 factors are robust (100.0%)
2025-10-28 19:42:25,336 - analysis.factor_stability - INFO -   - Stable factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:25,336 - __main__ - INFO - âœ… Stability analysis completed
2025-10-28 19:42:25,336 - __main__ - INFO -    Stable factors: 5/5
2025-10-28 19:42:25,336 - __main__ - INFO -    Stability rate: 100.0%
2025-10-28 19:42:25,336 - __main__ - INFO - ================================================================================
2025-10-28 19:42:25,336 - __main__ - INFO - COUNTING EFFECTIVE FACTORS PER CHAIN
2025-10-28 19:42:25,336 - __main__ - INFO - ================================================================================
2025-10-28 19:42:25,336 - __main__ - INFO - Thresholds:
2025-10-28 19:42:25,336 - __main__ - INFO -   - Sparsity: 0.001, Min nonzero %: 0.01
2025-10-28 19:42:25,336 - __main__ - INFO -   - ARD precision threshold: 100.0
2025-10-28 19:42:25,336 - __main__ - INFO -   - ARD variance threshold: 0.01
2025-10-28 19:42:25,336 - __main__ - WARNING - âš  tau_W samples not available - ARD-based method will be skipped
2025-10-28 19:42:25,336 - __main__ - INFO - 
============================================================
2025-10-28 19:42:25,336 - __main__ - INFO - CHAIN 0 - EFFECTIVE FACTOR ANALYSIS
2025-10-28 19:42:25,336 - __main__ - INFO - ============================================================
2025-10-28 19:42:25,336 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-28 19:42:25,336 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-28 19:42:25,337 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:25,337 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:25,337 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:25,337 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-28 19:42:26,137 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-28 19:42:26,137 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:26,137 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:26,137 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:26,137 - __main__ - INFO - 
Chain 0 - Method Comparison:
2025-10-28 19:42:26,137 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-28 19:42:26,137 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-28 19:42:26,137 - __main__ - INFO - 
============================================================
2025-10-28 19:42:26,138 - __main__ - INFO - CHAIN 1 - EFFECTIVE FACTOR ANALYSIS
2025-10-28 19:42:26,138 - __main__ - INFO - ============================================================
2025-10-28 19:42:26,138 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-28 19:42:26,138 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-28 19:42:26,138 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:26,138 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:26,138 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:26,138 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-28 19:42:27,076 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-28 19:42:27,076 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:27,076 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:27,076 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:27,076 - __main__ - INFO - 
Chain 1 - Method Comparison:
2025-10-28 19:42:27,076 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-28 19:42:27,076 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-28 19:42:27,076 - __main__ - INFO - 
============================================================
2025-10-28 19:42:27,076 - __main__ - INFO - CHAIN 2 - EFFECTIVE FACTOR ANALYSIS
2025-10-28 19:42:27,077 - __main__ - INFO - ============================================================
2025-10-28 19:42:27,077 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-28 19:42:27,077 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-28 19:42:27,077 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:27,077 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:27,077 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:27,077 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-28 19:42:28,026 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-28 19:42:28,026 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:28,026 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:28,026 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:28,026 - __main__ - INFO - 
Chain 2 - Method Comparison:
2025-10-28 19:42:28,027 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-28 19:42:28,027 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-28 19:42:28,027 - __main__ - INFO - 
============================================================
2025-10-28 19:42:28,027 - __main__ - INFO - CHAIN 3 - EFFECTIVE FACTOR ANALYSIS
2025-10-28 19:42:28,027 - __main__ - INFO - ============================================================
2025-10-28 19:42:28,027 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 1808 total features, K=5
2025-10-28 19:42:28,027 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-28 19:42:28,027 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:28,027 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:28,027 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:28,027 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=1808, K=5
2025-10-28 19:42:29,226 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-28 19:42:29,226 - analysis.factor_stability - INFO -   - 5/5 factors are effective
2025-10-28 19:42:29,226 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-28 19:42:29,226 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4]
2025-10-28 19:42:29,226 - __main__ - INFO - 
Chain 3 - Method Comparison:
2025-10-28 19:42:29,227 - __main__ - INFO -   Posterior Mean:    5/5 effective
2025-10-28 19:42:29,227 - __main__ - INFO -   Posterior Samples: 5/5 effective
2025-10-28 19:42:29,227 - __main__ - INFO - 
================================================================================
2025-10-28 19:42:29,227 - __main__ - INFO - EFFECTIVE FACTOR SUMMARY (Using preferred method)
2025-10-28 19:42:29,227 - __main__ - INFO - ================================================================================
2025-10-28 19:42:29,227 - __main__ - INFO - Chain 0 (Posterior Samples): 5/5 effective factors
2025-10-28 19:42:29,227 - __main__ - INFO - Chain 1 (Posterior Samples): 5/5 effective factors
2025-10-28 19:42:29,227 - __main__ - INFO - Chain 2 (Posterior Samples): 5/5 effective factors
2025-10-28 19:42:29,227 - __main__ - INFO - Chain 3 (Posterior Samples): 5/5 effective factors
2025-10-28 19:42:29,227 - __main__ - INFO - ================================================================================
2025-10-28 19:42:29,227 - __main__ - INFO - R-HAT CONVERGENCE DIAGNOSTICS
2025-10-28 19:42:29,227 - __main__ - INFO - ================================================================================
2025-10-28 19:42:29,227 - __main__ - INFO - NOTE: Raw R-hat reported for completeness. Aligned R-hat (below) is primary metric.
2025-10-28 19:42:29,227 - __main__ - INFO - 
2025-10-28 19:42:30,247 - __main__ - INFO - R-hat for W (factor loadings):
2025-10-28 19:42:30,247 - __main__ - INFO -   Overall: max=184.0549, mean=25.2989
2025-10-28 19:42:30,247 - __main__ - INFO -   Factor 0: max=93.8675, mean=8.2647 âš ï¸
2025-10-28 19:42:30,247 - __main__ - INFO -   Factor 1: max=184.0549, mean=17.8364 âš ï¸
2025-10-28 19:42:30,247 - __main__ - INFO -   Factor 2: max=146.0707, mean=86.0303 âš ï¸
2025-10-28 19:42:30,247 - __main__ - INFO -   Factor 3: max=43.5956, mean=8.5269 âš ï¸
2025-10-28 19:42:30,247 - __main__ - INFO -   Factor 4: max=88.6225, mean=5.8361 âš ï¸
2025-10-28 19:42:30,247 - __main__ - WARNING - âš ï¸  High raw R-hat detected for W: 184.0549 > 1.1
2025-10-28 19:42:30,247 - __main__ - WARNING -      This may reflect sign/rotation ambiguity in factor models.
2025-10-28 19:42:30,248 - __main__ - WARNING -      Check aligned R-hat below for true convergence assessment.
2025-10-28 19:42:30,298 - __main__ - INFO - R-hat for Z (factor scores):
2025-10-28 19:42:30,298 - __main__ - INFO -   Overall: max=161.1529, mean=32.6167
2025-10-28 19:42:30,298 - __main__ - INFO -   Factor 0: max=161.1529, mean=48.7689 âš ï¸
2025-10-28 19:42:30,298 - __main__ - INFO -   Factor 1: max=129.9204, mean=13.8171 âš ï¸
2025-10-28 19:42:30,298 - __main__ - INFO -   Factor 2: max=36.3300, mean=3.0489 âš ï¸
2025-10-28 19:42:30,298 - __main__ - INFO -   Factor 3: max=128.8103, mean=66.4080 âš ï¸
2025-10-28 19:42:30,298 - __main__ - INFO -   Factor 4: max=109.6338, mean=31.0407 âš ï¸
2025-10-28 19:42:30,298 - __main__ - WARNING - âš ï¸  High raw R-hat detected for Z: 161.1529 > 1.1
2025-10-28 19:42:30,298 - __main__ - WARNING -      This may reflect sign/rotation ambiguity in factor models.
2025-10-28 19:42:30,298 - __main__ - WARNING -      Check aligned R-hat below for true convergence assessment.
2025-10-28 19:42:30,298 - __main__ - INFO - ================================================================================
2025-10-28 19:42:30,298 - __main__ - INFO - ALIGNED R-HAT - PRIMARY CONVERGENCE METRIC
2025-10-28 19:42:30,298 - __main__ - INFO - (Accounts for sign/rotation indeterminacy in factor models)
2025-10-28 19:42:30,298 - __main__ - INFO - ================================================================================
2025-10-28 19:42:30,298 - __main__ - INFO - Computing aligned R-hat for W (factor loadings)...
2025-10-28 19:42:30,299 - analysis.factor_stability - INFO - Computing aligned R-hat (accounting for factor sign/rotation ambiguity)
2025-10-28 19:42:30,299 - analysis.factor_stability - INFO -   Input shape: (4, 10000, 1808, 5)
2025-10-28 19:42:30,299 - analysis.factor_stability - INFO -   Reference chain: 0
2025-10-28 19:42:32,165 - analysis.factor_stability - INFO -   Aligned 4/4 chains to reference
2025-10-28 19:42:32,165 - analysis.factor_stability - INFO -   âœ“ All factors matched across chains (good stability)
2025-10-28 19:42:33,280 - analysis.factor_stability - INFO -   Computing split Gelman-Rubin on 5 matched factors...
2025-10-28 19:42:34,300 - analysis.factor_stability - INFO -   Aligned R-hat results (matched factors only):
2025-10-28 19:42:34,301 - analysis.factor_stability - INFO -     Max R-hat overall:  12.2945
2025-10-28 19:42:34,301 - analysis.factor_stability - INFO -     Mean R-hat overall: 5.6334
2025-10-28 19:42:34,301 - analysis.factor_stability - INFO -     Parameters with R-hat < 1.1: 0/9040 (0.0%)
2025-10-28 19:42:34,307 - __main__ - INFO - Aligned R-hat for W:
2025-10-28 19:42:34,308 - __main__ - INFO -   Factor match rate:  100.0% (5/5 factors matched across all chains)
2025-10-28 19:42:34,308 - __main__ - INFO -   Max R-hat overall:  12.2945
2025-10-28 19:42:34,308 - __main__ - INFO -   Mean R-hat overall: 5.6334
2025-10-28 19:42:34,308 - __main__ - INFO -   Convergence rate:   0.0% (R-hat < 1.1)
2025-10-28 19:42:34,308 - __main__ - WARNING - âš  W: Good matching but poor R-hat (12.2945 >= 1.1) - need more samples
2025-10-28 19:42:34,308 - __main__ - INFO - âš¡ Alignment improved R-hat by 171.76
2025-10-28 19:42:34,308 - __main__ - INFO -    Raw: 184.0549 â†’ Aligned: 12.2945
2025-10-28 19:42:34,308 - __main__ - INFO - Computing aligned R-hat for Z (factor scores)...
2025-10-28 19:42:34,308 - analysis.factor_stability - INFO - Computing aligned R-hat (accounting for factor sign/rotation ambiguity)
2025-10-28 19:42:34,308 - analysis.factor_stability - INFO -   Input shape: (4, 10000, 86, 5)
2025-10-28 19:42:34,308 - analysis.factor_stability - INFO -   Reference chain: 0
2025-10-28 19:42:34,400 - analysis.factor_stability - INFO -   Aligned 4/4 chains to reference
2025-10-28 19:42:34,400 - analysis.factor_stability - INFO -   âœ“ All factors matched across chains (good stability)
2025-10-28 19:42:34,454 - analysis.factor_stability - INFO -   Computing split Gelman-Rubin on 5 matched factors...
2025-10-28 19:42:34,504 - analysis.factor_stability - INFO -   Aligned R-hat results (matched factors only):
2025-10-28 19:42:34,505 - analysis.factor_stability - INFO -     Max R-hat overall:  132.1965
2025-10-28 19:42:34,505 - analysis.factor_stability - INFO -     Mean R-hat overall: 15.6487
2025-10-28 19:42:34,505 - analysis.factor_stability - INFO -     Parameters with R-hat < 1.1: 0/430 (0.0%)
2025-10-28 19:42:34,505 - __main__ - INFO - Aligned R-hat for Z:
2025-10-28 19:42:34,505 - __main__ - INFO -   Factor match rate:  100.0% (5/5 factors matched across all chains)
2025-10-28 19:42:34,505 - __main__ - INFO -   Max R-hat overall:  132.1965
2025-10-28 19:42:34,505 - __main__ - INFO -   Mean R-hat overall: 15.6487
2025-10-28 19:42:34,506 - __main__ - INFO -   Convergence rate:   0.0% (R-hat < 1.1)
2025-10-28 19:42:34,506 - __main__ - WARNING - âš  Z: Good matching but poor R-hat (132.1965 >= 1.1) - need more samples
2025-10-28 19:42:34,506 - __main__ - INFO - âš¡ Alignment improved R-hat by 28.96
2025-10-28 19:42:34,506 - __main__ - INFO -    Raw: 161.1529 â†’ Aligned: 132.1965
2025-10-28 19:42:34,506 - __main__ - INFO - ================================================================================
2025-10-28 19:42:34,506 - __main__ - INFO - EFFECTIVE SAMPLE SIZE (ESS) DIAGNOSTICS
2025-10-28 19:42:34,506 - __main__ - INFO - ================================================================================
2025-10-28 19:42:34,506 - __main__ - INFO - Computing ESS for W (factor loadings)...
2025-10-28 19:42:34,506 - __main__ - WARNING - Failed to compute ESS diagnostics: effective_sample_size() got an unexpected keyword argument 'split_chains'
2025-10-28 19:42:34,517 - __main__ - WARNING - Traceback (most recent call last):
  File "/cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/experiments/robustness_testing.py", line 2904, in run_factor_stability_analysis
    ess_W_bulk = effective_sample_size(W_samples, split_chains=True)
TypeError: effective_sample_size() got an unexpected keyword argument 'split_chains'

2025-10-28 19:42:34,517 - __main__ - INFO - ================================================================================
2025-10-28 19:42:34,517 - __main__ - INFO - BFMI (BAYESIAN FRACTION OF MISSING INFORMATION)
2025-10-28 19:42:34,517 - __main__ - INFO - ================================================================================
2025-10-28 19:42:34,517 - __main__ - WARNING - No potential energy available - skipping BFMI computation
2025-10-28 19:42:35,318 - __main__ - INFO -   Using stored full chain samples (4 chains) with hyperparameters
2025-10-28 19:42:35,628 - __main__ - WARNING - Failed to create MCMC trace plots: name 'W_samples_aligned' is not defined
2025-10-28 19:42:35,629 - __main__ - WARNING - Traceback: Traceback (most recent call last):
  File "/cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/experiments/robustness_testing.py", line 3601, in _plot_factor_stability
    w_aligned = W_samples_aligned  # type: ignore[name-defined]
NameError: name 'W_samples_aligned' is not defined

2025-10-28 19:42:35,629 - __main__ - INFO - ðŸ“ Using experiment output dir for plots: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10
2025-10-28 19:42:40,044 - core.io_utils - INFO - Saved 3 plots individually to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10/individual_plots (0 skipped)
2025-10-28 19:42:40,044 - core.io_utils - INFO -   Formats: png, pdf
2025-10-28 19:42:40,044 - __main__ - INFO - âœ… Saved 3 individual plots to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10/individual_plots
2025-10-28 19:42:40,047 - __main__ - INFO - âœ… Generated 3 plots
2025-10-28 19:42:40,047 - __main__ - INFO -    - factor_stability_summary
2025-10-28 19:42:40,047 - __main__ - INFO -    - enhanced_loading_distributions
2025-10-28 19:42:40,047 - __main__ - INFO -    - factor_stability_heatmap
2025-10-28 19:42:40,047 - __main__ - INFO - ================================================================================
2025-10-28 19:42:40,047 - __main__ - INFO - ================================================================================
2025-10-28 19:42:40,047 - __main__ - INFO - Summary:
2025-10-28 19:42:40,047 - __main__ - INFO -   - 4 chains completed
2025-10-28 19:42:40,048 - __main__ - INFO -   - 5/5 stable factors
2025-10-28 19:42:40,048 - __main__ - INFO -   - Stability rate: 100.0%
2025-10-28 19:42:40,048 - __main__ - INFO -   - Mean effective factors: 5.0
2025-10-28 19:42:40,048 - __main__ - INFO -   Convergence Diagnostics:
2025-10-28 19:42:40,048 - __main__ - INFO -     - R-hat (W, aligned) [PRIMARY]: max=12.2945, mean=5.6334 âš ï¸ (0.0% < 1.1)
2025-10-28 19:42:40,048 - __main__ - INFO -     - R-hat (Z, aligned) [PRIMARY]: max=132.1965, mean=15.6487 âš ï¸ (0.0% < 1.1)
2025-10-28 19:42:40,048 - __main__ - INFO -     [Raw R-hat for reference - may be high due to sign/rotation ambiguity]
2025-10-28 19:42:40,048 - __main__ - INFO -     - R-hat (W, raw): max=184.0549, mean=25.2989 âš ï¸
2025-10-28 19:42:40,048 - __main__ - INFO -     - R-hat (Z, raw): max=161.1529, mean=32.6167 âš ï¸
2025-10-28 19:42:40,048 - __main__ - INFO -   - 3 plots generated
2025-10-28 19:42:40,048 - __main__ - INFO - ================================================================================
2025-10-28 19:42:40,048 - __main__ - INFO - SAVING CONSENSUS FACTOR LOADINGS AND SCORES
2025-10-28 19:42:40,048 - __main__ - INFO - ================================================================================
2025-10-28 19:42:40,048 - __main__ - INFO - Saving to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10
2025-10-28 19:42:40,048 - analysis.factor_stability - INFO - Saving stability results to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10
2025-10-28 19:42:40,076 - analysis.factor_stability - INFO -   âœ… Saved consensus factor loadings (W): (1808, 5)
2025-10-28 19:42:40,076 - analysis.factor_stability - INFO -   Saving per-view consensus loadings...
2025-10-28 19:42:40,092 - analysis.factor_stability - INFO -     âœ… Saved volume_sn_voxels loadings (W): (1794, 5)
2025-10-28 19:42:40,148 - analysis.factor_stability - INFO -     âœ… Saved SN Factor_0 reconstruction: 86 subjects Ã— 1794 voxels
2025-10-28 19:42:40,203 - analysis.factor_stability - INFO -     âœ… Saved SN Factor_1 reconstruction: 86 subjects Ã— 1794 voxels
2025-10-28 19:42:40,265 - analysis.factor_stability - INFO -     âœ… Saved SN Factor_2 reconstruction: 86 subjects Ã— 1794 voxels
2025-10-28 19:42:40,326 - analysis.factor_stability - INFO -     âœ… Saved SN Factor_3 reconstruction: 86 subjects Ã— 1794 voxels
2025-10-28 19:42:40,381 - analysis.factor_stability - INFO -     âœ… Saved SN Factor_4 reconstruction: 86 subjects Ã— 1794 voxels
2025-10-28 19:42:40,386 - analysis.factor_stability - INFO -     âœ… Saved clinical loadings (W): (14, 5)
2025-10-28 19:42:40,392 - analysis.factor_stability - INFO -     âœ… Saved clinical Factor_0 reconstruction: 86 subjects Ã— 14 features
2025-10-28 19:42:40,397 - analysis.factor_stability - INFO -     âœ… Saved clinical Factor_1 reconstruction: 86 subjects Ã— 14 features
2025-10-28 19:42:40,405 - analysis.factor_stability - INFO -     âœ… Saved clinical Factor_2 reconstruction: 86 subjects Ã— 14 features
2025-10-28 19:42:40,411 - analysis.factor_stability - INFO -     âœ… Saved clinical Factor_3 reconstruction: 86 subjects Ã— 14 features
2025-10-28 19:42:40,416 - analysis.factor_stability - INFO -     âœ… Saved clinical Factor_4 reconstruction: 86 subjects Ã— 14 features
2025-10-28 19:42:40,421 - analysis.factor_stability - INFO -   âœ… Saved consensus factor scores (Z median): (86, 5)
2025-10-28 19:42:40,425 - analysis.factor_stability - INFO -   âœ… Saved consensus Z posterior std: (86, 5)
2025-10-28 19:42:40,429 - analysis.factor_stability - INFO -   âœ… Saved consensus Z 2.5th percentile (lower 95% CI)
2025-10-28 19:42:40,435 - analysis.factor_stability - INFO -   âœ… Saved consensus Z 97.5th percentile (upper 95% CI)
2025-10-28 19:42:40,435 - analysis.factor_stability - INFO -   ðŸ“Š Z posterior uncertainty quantified (Aspect 6: Z Indeterminacy)
2025-10-28 19:42:40,438 - analysis.factor_stability - INFO -   âœ… Saved similarity matrix: .csv format
2025-10-28 19:42:40,438 - analysis.factor_stability - INFO -   Saving posterior geometry diagnostics...
2025-10-28 19:42:40,440 - analysis.factor_stability - INFO - Factor stability results saved successfully
2025-10-28 19:42:40,441 - __main__ - INFO - âœ… Consensus factor loadings and scores saved successfully
2025-10-28 19:42:40,441 - __main__ - INFO - Returning ExperimentResult object
2025-10-28 19:42:40,449 - __main__ - INFO -    âœ… Factor stability analysis COMPLETED
2025-10-28 19:42:40,449 - __main__ - INFO -    Result type: <class 'experiments.framework.ExperimentResult'>
2025-10-28 19:42:40,449 - __main__ - INFO -    Result status: completed
2025-10-28 19:42:40,449 - __main__ - INFO -    Model results keys: ['chain_results', 'stability_results', 'effective_factors']
2025-10-28 19:42:40,449 - __main__ - INFO -    ðŸ’¾ Saving factor loadings and scores...
2025-10-28 19:42:40,548 - __main__ - INFO -    Saved R-hat convergence diagnostics to rhat_convergence_diagnostics.json
2025-10-28 19:42:43,838 - __main__ - INFO -    âœ“ Results saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10
2025-10-28 19:42:43,838 - __main__ - INFO -    âœ“ Found 5/5 stable factors
2025-10-28 19:42:43,838 - __main__ - INFO -    âœ“ Stability rate: 100.0%
2025-10-28 19:42:43,838 - __main__ - INFO -    âœ“ Factor loadings (W) and scores (Z) saved for all 4 chains
2025-10-28 19:42:43,838 - __main__ - INFO - ================================================================================
2025-10-28 19:42:43,838 - __main__ - INFO - ðŸ”¬ Running comprehensive factor analysis diagnostics...
2025-10-28 19:42:43,838 - __main__ - INFO - ================================================================================
2025-10-28 19:42:43,845 - __main__ - INFO -   ðŸ“Š Aspect 2: Procrustes alignment...
2025-10-28 19:42:43,845 - analysis.factor_stability - INFO - ================================================================================
2025-10-28 19:42:43,845 - analysis.factor_stability - INFO - ASSESS_FACTOR_STABILITY_PROCRUSTES - START
2025-10-28 19:42:43,845 - analysis.factor_stability - INFO - ================================================================================
2025-10-28 19:42:43,845 - analysis.factor_stability - INFO - Analyzing 4 chains using Procrustes alignment
2025-10-28 19:42:43,845 - analysis.factor_stability - INFO -   Scale normalization: True
2025-10-28 19:42:43,846 - analysis.factor_stability - INFO -   Disparity threshold: 0.3
2025-10-28 19:42:43,846 - analysis.factor_stability - INFO -   Min match rate: 0.5
2025-10-28 19:42:43,846 - __main__ - ERROR - âŒ Factor analysis diagnostics FAILED: 'list' object has no attribute 'shape'
2025-10-28 19:42:43,855 - __main__ - ERROR - Traceback (most recent call last):
  File "/cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/run_experiments.py", line 1091, in main
    diagnostics['procrustes_alignment'] = assess_factor_stability_procrustes(
  File "/cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/analysis/factor_stability.py", line 550, in assess_factor_stability_procrustes
    N, K = W_chains[0].shape[0], W_chains[0].shape[1]
AttributeError: 'list' object has no attribute 'shape'

2025-10-28 19:42:43,855 - __main__ - INFO - ðŸ§¬ Running PD subtype discovery using consensus factors
2025-10-28 19:42:48,055 - __main__ - INFO - Auto-configured system: 16.0GB memory limit
2025-10-28 19:42:48,058 - __main__ - INFO - ðŸ“ Log handler already exists for results/experiments.log - skipping duplicate
2025-10-28 19:42:48,059 - __main__ - INFO - ExperimentFramework initialized with output dir: results
2025-10-28 19:42:48,059 - __main__ - INFO - Auto-configured system: 16.0GB memory limit
2025-10-28 19:42:48,059 - __main__ - INFO - Memory optimizer initialized with 16.0GB limit
2025-10-28 19:42:48,059 - __main__ - INFO - Data streaming components initialized
2025-10-28 19:42:48,059 - __main__ - INFO - MCMC memory optimizer initialized
2025-10-28 19:42:49,180 - __main__ - INFO - Optimal number of PD subtypes: 2
2025-10-28 19:42:49,180 - __main__ - INFO - Best silhouette score: 0.878
2025-10-28 19:42:49,180 - __main__ - INFO -    âœ“ Discovered 2 subtypes (silhouette=0.878)
2025-10-28 19:42:49,180 - visualization.subtype_plots - INFO - Creating PD subtype discovery visualizations
2025-10-28 19:42:52,388 - visualization.subtype_plots - INFO - PD subtype plots saved to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/02_factor_stability_fixed_K5_percW33_slab4_2_tree10/pd_subtype_discovery
2025-10-28 19:42:52,388 - __main__ - INFO -    âœ“ PD subtype visualization plots generated
2025-10-28 19:42:52,393 - __main__ - INFO -    âœ“ Results saved to: pd_subtype_discovery/
2025-10-28 19:42:52,396 - __main__ - INFO - ðŸ“Š Cache statistics: 0 memory entries, 0 disk entries
2025-10-28 19:42:52,396 - core.results_cache - INFO - ðŸ—‘ï¸  Cache cleared
2025-10-28 19:42:52,396 - __main__ - INFO - ðŸ—‘ï¸  SGFA results cache cleared
2025-10-28 19:42:52,396 - __main__ - INFO -  All experiments completed!
2025-10-28 19:42:52,396 - __main__ - INFO -   Total duration: 6:03:52.821373
2025-10-28 19:42:52,397 - __main__ - INFO -  Results saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859
2025-10-28 19:42:52,397 - __main__ - INFO - ðŸ“‹ Creating comprehensive experiment summary...
2025-10-28 19:42:52,402 - __main__ - INFO - ðŸ“‹ Comprehensive summary saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/summaries/complete_experiment_summary.yaml
2025-10-28 19:42:52,402 - __main__ - INFO - ðŸ“– Quick reference saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-sn_conf-age+sex+tiv_K5_run_20251028_133859/README.md
