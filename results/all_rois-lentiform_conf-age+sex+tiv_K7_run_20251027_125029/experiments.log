2025-10-27 12:50:29,314 - __main__ - INFO - ðŸ“ Comprehensive pipeline logging configured: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/experiments.log
2025-10-27 12:50:29,314 - __main__ - INFO -    All experiments will log to this single file
2025-10-27 12:50:29,316 - core.config_utils - INFO - Ensured output directory exists: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029
2025-10-27 12:50:29,316 - core.config_utils - INFO - Ensured checkpoint directory exists: results/checkpoints
2025-10-27 12:50:29,316 - __main__ - INFO -  Available devices: [cuda(id=0)]
2025-10-27 12:50:29,316 - __main__ - INFO -  GPU devices available for acceleration: [cuda(id=0)]
2025-10-27 12:50:29,319 - core.results_cache - INFO - ðŸ“¦ SGFA results cache initialized: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/.sgfa_cache
2025-10-27 12:50:29,319 - __main__ - INFO -  Starting Remote Workstation Experimental Framework at 2025-10-27 12:50:29.319191
2025-10-27 12:50:29,319 - __main__ - INFO -  Running experiments: ['all']
2025-10-27 12:50:29,319 - __main__ - INFO - â„¹ï¸  Running core analysis pipeline: data_validation â†’ factor_stability
2025-10-27 12:50:29,319 - __main__ - INFO - ðŸ”— Using SHARED DATA MODE - efficient pipeline with data reuse
2025-10-27 12:50:29,319 - __main__ - INFO - ðŸ”„ Pipeline context initialized (shared_mode: True)
2025-10-27 12:50:29,319 - __main__ - INFO - ðŸ” 1/2 Starting Data Validation Experiment...
2025-10-27 12:50:29,319 - experiments.data_validation - INFO - Starting Data Validation Experiments
2025-10-27 12:50:29,319 - experiments.data_validation - INFO - Running comprehensive data validation with EDA plots...
2025-10-27 12:50:29,320 - experiments.data_validation - INFO - ðŸ“ Using unified directory structure: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10
2025-10-27 12:50:29,321 - experiments.framework - INFO - ðŸ“ Log handler already exists for /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/experiments.log - skipping duplicate
2025-10-27 12:50:29,321 - experiments.framework - INFO - ExperimentFramework initialized with output dir: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029
2025-10-27 12:50:29,326 - experiments.framework - INFO - Starting experiment: data_validation_20251027_125029
2025-10-27 12:50:29,326 - experiments.data_validation - INFO - Running comprehensive data validation...
2025-10-27 12:50:29,327 - experiments.data_validation - INFO - Auto-configured system: 22.3GB memory limit
2025-10-27 12:50:29,329 - experiments.data_validation - INFO - ExperimentFramework initialized with output dir: results
2025-10-27 12:50:29,329 - experiments.data_validation - INFO - Auto-configured system: 22.3GB memory limit
2025-10-27 12:50:29,329 - experiments.data_validation - INFO - Memory optimizer initialized with 22.3GB limit
2025-10-27 12:50:29,330 - experiments.data_validation - INFO - Data streaming components initialized
2025-10-27 12:50:29,330 - experiments.data_validation - INFO - MCMC memory optimizer initialized
2025-10-27 12:50:29,330 - experiments.data_validation - INFO - Running data quality assessment
2025-10-27 12:50:29,330 - experiments.data_validation - INFO - Loading qMAP-PD data for quality assessment...
2025-10-27 12:50:29,330 - experiments.data_validation - INFO -    ROI selection: ['volume_lentiform_voxels.tsv']
2025-10-27 12:50:29,330 - experiments.data_validation - INFO -    Confound regression: ['age', 'sex', 'tiv']
2025-10-27 12:50:29,330 - experiments.data_validation - INFO -    Feature selection: none
2025-10-27 12:50:29,369 - root - INFO - Loading selected ROIs: ['volume_lentiform_voxels.tsv']
2025-10-27 12:50:30,171 - root - INFO - Regressing out confounds (before preprocessing): ['age', 'sex', 'tiv']
2025-10-27 12:50:30,241 - root - INFO -   Regressed confounds from volume_lentiform_voxels: ['age', 'sex', 'tiv']
2025-10-27 12:50:30,242 - root - INFO -   Dropped 3 confound features from clinical: ['age', 'sex', 'tiv']
2025-10-27 12:50:30,242 - root - INFO -   Remaining clinical features: 14
2025-10-27 12:50:30,242 - root - INFO - âœ… Confound regression complete (before preprocessing)
2025-10-27 12:50:30,258 - root - INFO - Preprocessing module imported successfully
2025-10-27 12:50:30,284 - experiments.data_validation - INFO -    PCA enabled in preprocessing_config: False
2025-10-27 12:50:30,296 - root - INFO - Loading selected ROIs: ['volume_lentiform_voxels.tsv']
2025-10-27 12:50:30,929 - root - INFO - Regressing out confounds (before preprocessing): ['age', 'sex', 'tiv']
2025-10-27 12:50:30,945 - root - INFO -   Regressed confounds from volume_lentiform_voxels: ['age', 'sex', 'tiv']
2025-10-27 12:50:30,946 - root - INFO -   Dropped 3 confound features from clinical: ['age', 'sex', 'tiv']
2025-10-27 12:50:30,946 - root - INFO -   Remaining clinical features: 14
2025-10-27 12:50:30,946 - root - INFO - âœ… Confound regression complete (before preprocessing)
2025-10-27 12:50:30,946 - root - INFO - Starting neuroimaging-aware preprocessing pipeline
2025-10-27 12:50:30,946 - root - INFO - MAD filtering disabled for volume_lentiform_voxels (threshold=None)
2025-10-27 12:50:31,032 - root - INFO - Applying none feature selection to volume_lentiform_voxels
2025-10-27 12:50:31,033 - root - INFO - Applying standard scaling to volume_lentiform_voxels
2025-10-27 12:50:31,041 - data.preprocessing - WARNING - âš ï¸  volume_lentiform_voxels standardization verification FAILED:
2025-10-27 12:50:31,041 - data.preprocessing - INFO -    âœ“ Mean: -0.000000
2025-10-27 12:50:31,041 - data.preprocessing - INFO -    âœ“ Std:  1.005865
2025-10-27 12:50:31,041 - data.preprocessing - WARNING -    âŒ Max:  8.96 (threshold: 5.0)
2025-10-27 12:50:31,041 - data.preprocessing - WARNING -       This suggests EXTREME outliers or non-standardized data!
2025-10-27 12:50:31,041 - data.preprocessing - WARNING -       SGFA horseshoe priors assume standardized inputs.
2025-10-27 12:50:31,042 - root - INFO - Applying none feature selection to clinical
2025-10-27 12:50:31,043 - root - INFO - Applying standard scaling to clinical
2025-10-27 12:50:31,043 - data.preprocessing - INFO - âœ… clinical standardization verified:
2025-10-27 12:50:31,043 - data.preprocessing - INFO -    Mean: 0.000000 (target: 0.0, tol: 0.1)
2025-10-27 12:50:31,043 - data.preprocessing - INFO -    Std:  1.005865 (target: 1.0, tol: 0.2)
2025-10-27 12:50:31,043 - data.preprocessing - INFO -    Max:  3.62 (threshold: 5.0)
2025-10-27 12:50:31,044 - experiments.data_validation - INFO -    âœ… Filtered position lookups saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/position_lookup_filtered
2025-10-27 12:50:31,044 - experiments.data_validation - INFO -    Creating filtered position lookups with output_dir: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10
2025-10-27 12:50:31,044 - experiments.data_validation - INFO -   _create_filtered_position_lookups called:
2025-10-27 12:50:31,044 - experiments.data_validation - INFO -     view_names: ['volume_lentiform_voxels', 'clinical']
2025-10-27 12:50:31,044 - experiments.data_validation - INFO -     n_views raw: 2, preprocessed: 2
2025-10-27 12:50:31,044 - experiments.data_validation - INFO -   Creating filtered position lookup for volume_lentiform_voxels...
2025-10-27 12:50:31,046 - experiments.data_validation - INFO -   Original positions: 7201 rows
2025-10-27 12:50:31,046 - experiments.data_validation - INFO -   Raw data: 7201 voxels
2025-10-27 12:50:31,046 - experiments.data_validation - INFO -   Preprocessed data: 7201 voxels
2025-10-27 12:50:31,047 - experiments.data_validation - INFO -   No voxels dropped, position lookup unchanged
2025-10-27 12:50:31,060 - experiments.data_validation - INFO -   âœ… Saved filtered position lookup: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/filtered_position_lookups/lentiform_filtered_position_lookup.csv
2025-10-27 12:50:31,060 - experiments.data_validation - INFO -      7201 â†’ 7201 rows
2025-10-27 12:50:31,060 - experiments.data_validation - INFO -   Skipping clinical view
2025-10-27 12:50:31,060 - experiments.data_validation - INFO -    âœ… Filtered position lookups saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/filtered_position_lookups
2025-10-27 12:50:31,060 - experiments.data_validation - INFO -    Files created: ['/cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/filtered_position_lookups/lentiform_filtered_position_lookup.csv']
2025-10-27 12:50:31,061 - experiments.data_validation - INFO - Data structure analysis completed. Raw: 7215 features, Processed: 7215 features
2025-10-27 12:50:31,061 - experiments.data_validation - INFO - ðŸ” Assessing data quality metrics...
2025-10-27 12:50:31,061 - experiments.data_validation - INFO -    Analyzing quality metrics for volume_lentiform_voxels (86Ã—7201)...
2025-10-27 12:50:31,075 - experiments.data_validation - INFO -    Analyzing quality metrics for clinical (86Ã—14)...
2025-10-27 12:50:31,076 - experiments.data_validation - INFO -       Computing correlation matrix for clinical...
2025-10-27 12:50:31,092 - experiments.data_validation - INFO -    Analyzing quality metrics for volume_lentiform_voxels (86Ã—7201)...
2025-10-27 12:50:31,106 - experiments.data_validation - INFO -    Analyzing quality metrics for clinical (86Ã—14)...
2025-10-27 12:50:31,106 - experiments.data_validation - INFO -       Computing correlation matrix for clinical...
2025-10-27 12:50:31,107 - experiments.data_validation - INFO - ðŸ“Š Estimating Signal-to-Noise Ratio (SNR)...
2025-10-27 12:50:31,107 - experiments.data_validation - INFO -    Analyzing SNR for volume_lentiform_voxels ((86, 7201))...
2025-10-27 12:50:31,233 - experiments.data_validation - INFO -       PCA SNR: 3.26 (signal=9 PCs)
2025-10-27 12:50:31,233 - experiments.data_validation - INFO -       Effective dim (95%): 33 PCs
2025-10-27 12:50:31,233 - experiments.data_validation - INFO -       Scree elbow at PC: 2
2025-10-27 12:50:31,238 - experiments.data_validation - INFO -       Variance SNR: 0.00
2025-10-27 12:50:31,253 - experiments.data_validation - INFO -       Feature SNR: median=0.00
2025-10-27 12:50:31,253 - experiments.data_validation - INFO -    ðŸ“‹ SNR Interpretation for volume_lentiform_voxels:
2025-10-27 12:50:31,253 - experiments.data_validation - INFO -       Signal quality: Moderate (SNR 3-10): Adequate signal, moderate noise
2025-10-27 12:50:31,253 - experiments.data_validation - INFO -       Recommended K: 2-2 (moderate signal)
2025-10-27 12:50:31,253 - experiments.data_validation - INFO -       Prior strength: MODERATE priors (SNR 2-5): Use Ï„â‚€ floor (current: 0.3)
2025-10-27 12:50:31,253 - experiments.data_validation - INFO -       Convergence: MODERATE: May need longer chains or stronger priors
2025-10-27 12:50:31,254 - experiments.data_validation - INFO -    Analyzing SNR for clinical ((86, 14))...
2025-10-27 12:50:31,257 - experiments.data_validation - INFO -       PCA SNR: 14.65 (signal=9 PCs)
2025-10-27 12:50:31,260 - experiments.data_validation - INFO -       Effective dim (95%): 10 PCs
2025-10-27 12:50:31,260 - experiments.data_validation - INFO -       Scree elbow at PC: 2
2025-10-27 12:50:31,261 - experiments.data_validation - INFO -       Variance SNR: 0.00
2025-10-27 12:50:31,261 - experiments.data_validation - INFO -       Feature SNR: median=0.00
2025-10-27 12:50:31,262 - experiments.data_validation - INFO -    ðŸ“‹ SNR Interpretation for clinical:
2025-10-27 12:50:31,262 - experiments.data_validation - INFO -       Signal quality: High (SNR > 10): Strong signal, low noise
2025-10-27 12:50:31,263 - experiments.data_validation - INFO -       Recommended K: 2-8 (signal supports more factors)
2025-10-27 12:50:31,263 - experiments.data_validation - INFO -       Prior strength: WEAK priors ok (SNR > 5): Data-dependent Ï„â‚€ may suffice
2025-10-27 12:50:31,263 - experiments.data_validation - INFO -       Convergence: GOOD: High SNR + well-defined subspace
2025-10-27 12:50:31,263 - experiments.data_validation - INFO - âœ… SNR estimation complete for all views
2025-10-27 12:50:31,333 - experiments.data_validation - INFO - ================================================================================
2025-10-27 12:50:31,333 - experiments.data_validation - INFO - ðŸ” MAD THRESHOLD EXPLORATORY DATA ANALYSIS
2025-10-27 12:50:31,333 - experiments.data_validation - INFO - ================================================================================
2025-10-27 12:50:31,333 - experiments.data_validation - INFO - Analyzing optimal MAD threshold values for outlier detection...
2025-10-27 12:50:31,334 - experiments.data_validation - INFO - Analyzing 1 imaging views: ['volume_lentiform_voxels']
2025-10-27 12:50:31,334 - experiments.data_validation - INFO - ðŸ“Š Analyzing MAD distributions...
2025-10-27 12:50:31,334 - experiments.data_validation - INFO -    Processing volume_lentiform_voxels: (86, 7201)
2025-10-27 12:50:32,512 - experiments.data_validation - INFO -       Saved MAD distribution plot: mad_distribution_lentiform.png
2025-10-27 12:50:32,513 - experiments.data_validation - INFO -    âœ… MAD distributions analyzed for 1 views
2025-10-27 12:50:32,513 - experiments.data_validation - INFO - ðŸ“ˆ Performing elbow analysis...
2025-10-27 12:50:32,525 - experiments.data_validation - INFO -    volume_lentiform_voxels: Elbow at 3.78 (60.3% retention)
2025-10-27 12:50:32,941 - experiments.data_validation - INFO -    âœ… Elbow analysis completed, saved to elbow_analysis_all_views.png
2025-10-27 12:50:32,942 - experiments.data_validation - INFO - ðŸ—ºï¸  Analyzing spatial distribution of removed voxels...
2025-10-27 12:50:32,944 - experiments.data_validation - INFO -    Loaded position lookup for volume_lentiform_voxels: 7201 voxels
2025-10-27 12:50:34,471 - experiments.data_validation - INFO -       Saved spatial distribution plot: spatial_distribution_lentiform.png
2025-10-27 12:50:34,471 - experiments.data_validation - INFO -    âœ… Spatial analysis completed for 1 views
2025-10-27 12:50:34,471 - experiments.data_validation - INFO - ðŸ“Š Analyzing information preservation...
2025-10-27 12:50:34,471 - experiments.data_validation - INFO -    Processing volume_lentiform_voxels...
2025-10-27 12:50:35,093 - experiments.data_validation - INFO -       Saved information preservation plot: information_preservation_all_views.png
2025-10-27 12:50:35,093 - experiments.data_validation - INFO -    âœ… Information preservation analyzed for 1 views
2025-10-27 12:50:35,093 - experiments.data_validation - INFO - ðŸ‘¤ Analyzing subject-level data quality...
2025-10-27 12:50:35,093 - experiments.data_validation - INFO -    Processing volume_lentiform_voxels: (86, 7201)
2025-10-27 12:50:36,180 - experiments.data_validation - INFO -       Mean outlier %: 1.9%
2025-10-27 12:50:36,180 - experiments.data_validation - INFO -       Max outlier %: 18.1%
2025-10-27 12:50:36,644 - experiments.data_validation - INFO -       Saved subject outlier distribution plot: subject_outlier_distributions.png
2025-10-27 12:50:36,647 - experiments.data_validation - INFO -       Saved flagged subjects table: flagged_subjects.csv (9 subjects)
2025-10-27 12:50:36,649 - experiments.data_validation - INFO -       Saved flagged subjects report: flagged_subjects_report.txt
2025-10-27 12:50:36,950 - experiments.data_validation - INFO -       Saved subject outlier comparison plot: subject_outlier_comparison.png
2025-10-27 12:50:37,717 - experiments.data_validation - INFO -       Saved subject outlier scatter plot: subject_outlier_scatter.png
2025-10-27 12:50:38,395 - experiments.data_validation - INFO -       Saved top subjects bar chart: subject_outlier_top20.png
2025-10-27 12:50:38,395 - experiments.data_validation - INFO -    âœ… Subject-level analysis completed: 9 subjects flagged
2025-10-27 12:50:38,395 - experiments.data_validation - INFO - ðŸ“‹ Generating threshold comparison summary...
2025-10-27 12:50:38,397 - experiments.data_validation - INFO -    Saved summary table: mad_threshold_summary_table.csv
2025-10-27 12:50:38,399 - experiments.data_validation - INFO -    ðŸ“ Saved recommendations: mad_threshold_recommendations.txt
2025-10-27 12:50:38,399 - experiments.data_validation - INFO - ================================================================================
2025-10-27 12:50:38,399 - experiments.data_validation - INFO - âœ… MAD threshold EDA completed successfully
2025-10-27 12:50:38,399 - experiments.data_validation - INFO - ================================================================================
2025-10-27 12:50:38,400 - experiments.data_validation - INFO - ðŸ“Š Generating data validation plots...
2025-10-27 12:50:38,400 - experiments.data_validation - INFO -    Creating distribution histograms for 1 clinical view(s), skipping 1 imaging views
2025-10-27 12:50:38,527 - experiments.data_validation - INFO -    âœ… Distribution histograms created (stored as data_distribution_comparison)
2025-10-27 12:50:38,534 - experiments.data_validation - INFO - ðŸ“Š Basic data validation plots completed: 1 plots generated
2025-10-27 12:50:38,534 - experiments.data_validation - INFO - ðŸŽ¨ Creating comprehensive data validation visualizations for data_quality_assessment
2025-10-27 12:50:38,543 - visualization.preprocessing_plots - INFO - Creating preprocessing plots
2025-10-27 12:50:38,545 - visualization.covariance_plots - INFO - ================================================================================
2025-10-27 12:50:38,545 - visualization.covariance_plots - INFO - COVARIANCE STRUCTURE ANALYSIS
2025-10-27 12:50:38,545 - visualization.covariance_plots - INFO - ================================================================================
2025-10-27 12:50:39,703 - visualization.covariance_plots - INFO - Intra-modality covariance for volume_lentiform_voxels: 7201x7201
2025-10-27 12:50:39,704 - visualization.covariance_plots - INFO - Intra-modality covariance for clinical: 14x14
2025-10-27 12:50:40,283 - visualization.covariance_plots - INFO - Inter-modality covariance for volume_lentiform_voxels_vs_clinical: 7201x14
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO - 
Data structure:
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO -   Number of views: 2
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO -   Number of samples: 86
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO -   volume_lentiform_voxels: 7201 features
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO -   clinical: 14 features
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO - 
Intra-modality correlation statistics:
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO -   volume_lentiform_voxels:
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO -     Mean correlation: 0.232
2025-10-27 12:50:41,823 - visualization.covariance_plots - INFO -     Std correlation: 0.282
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -     Max |correlation|: 1.000
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -   clinical:
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -     Mean correlation: 0.073
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -     Std correlation: 0.350
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -     Max |correlation|: 0.911
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO - 
Inter-modality correlation statistics:
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -   volume_lentiform_voxels_vs_clinical:
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -     Mean correlation: 0.016
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -     Std correlation: 0.109
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO -     Max |correlation|: 0.345
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO - 
Generating covariance plots...
2025-10-27 12:50:41,824 - visualization.covariance_plots - INFO - Subsampling covariance matrix from 7215 to 500 features
2025-10-27 12:50:44,572 - visualization.covariance_plots - INFO - Saved block covariance matrix plot to results/plots/block_covariance_matrix.png
2025-10-27 12:52:30,624 - visualization.covariance_plots - INFO - Saved inter/intra comparison plot to results/plots/inter_vs_intra_correlation.png
2025-10-27 12:52:30,626 - visualization.covariance_plots - INFO - Plots saved to results/plots
2025-10-27 12:52:30,626 - visualization.covariance_plots - INFO - ================================================================================
2025-10-27 12:52:30,629 - experiments.data_validation - INFO -    Found 2 plot files to convert
2025-10-27 12:52:31,098 - experiments.data_validation - INFO -    âœ… Created 2 comprehensive data validation visualizations
2025-10-27 12:52:31,098 - experiments.data_validation - INFO - ðŸŽ¨ Comprehensive data validation plots completed: 2 advanced plots generated
2025-10-27 12:52:31,105 - experiments.data_validation - INFO - ðŸ“Š Creating SNR analysis plots...
2025-10-27 12:52:31,105 - experiments.data_validation - INFO - ðŸ“Š Creating SNR analysis visualizations...
2025-10-27 12:52:31,105 - experiments.data_validation - INFO -    Generating 3-panel SNR plot for volume_lentiform_voxels...
2025-10-27 12:52:31,314 - experiments.data_validation - INFO -       âœ… Created SNR plot: snr_analysis_volume_lentiform_voxels.png
2025-10-27 12:52:31,315 - experiments.data_validation - INFO -    Generating 3-panel SNR plot for clinical...
2025-10-27 12:52:31,344 - experiments.data_validation - INFO -       âœ… Created SNR plot: snr_analysis_clinical.png
2025-10-27 12:52:31,344 - experiments.data_validation - INFO - âœ… Generated 2 SNR visualization(s)
2025-10-27 12:52:31,344 - experiments.data_validation - INFO - ðŸ“Š Total plots ready for saving: 5
2025-10-27 12:52:31,344 - experiments.data_validation - INFO - ðŸ“ Using experiment output dir: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10
2025-10-27 12:52:39,505 - core.io_utils - INFO - Saved 5 plots individually to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/individual_plots (0 skipped)
2025-10-27 12:52:39,506 - core.io_utils - INFO -   Formats: png, pdf
2025-10-27 12:52:39,506 - experiments.data_validation - INFO - âœ… Saved 5 individual plots to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/individual_plots
2025-10-27 12:52:39,506 - experiments.data_validation - INFO - ðŸ“Š Saving SNR analysis results...
2025-10-27 12:52:39,506 - experiments.data_validation - INFO - ðŸ“Š Saving SNR analysis results...
2025-10-27 12:52:39,508 - experiments.data_validation - INFO -    âœ… Saved SNR text report: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/snr_analysis/snr_report.txt
2025-10-27 12:52:39,508 - experiments.data_validation - INFO - âœ… SNR results saved successfully
2025-10-27 12:52:39,508 - experiments.data_validation - INFO - âœ… Data validation with EDA completed!
2025-10-27 12:52:39,508 - experiments.data_validation - INFO -    Plots generated: 5
2025-10-27 12:52:39,508 - experiments.framework - INFO - ðŸ EXPERIMENT COMPLETED: data_validation_20251027_125029
2025-10-27 12:52:39,508 - experiments.framework - INFO - â±ï¸  TOTAL RUNTIME: 2.2 minutes (130s)
2025-10-27 12:52:39,508 - experiments.framework - INFO - ðŸ• Started: 2025-10-27 12:50:29
2025-10-27 12:52:39,508 - experiments.framework - INFO - ðŸ•‘ Finished: 2025-10-27 12:52:39
2025-10-27 12:52:39,508 - experiments.framework - INFO - Experiment completed successfully: data_validation_20251027_125029
2025-10-27 12:52:39,508 - experiments.framework - INFO - ðŸ§¹ Performing comprehensive memory cleanup...
2025-10-27 12:52:39,603 - experiments.framework - INFO - Garbage collection freed 4864 objects
2025-10-27 12:52:39,938 - experiments.framework - INFO - GPU memory cleanup attempted
2025-10-27 12:52:40,940 - experiments.framework - INFO - âœ… Comprehensive memory cleanup completed
2025-10-27 12:52:41,265 - experiments.framework - INFO - Pickle saving disabled to prevent large files - using JSON and CSV instead
2025-10-27 12:52:41,270 - experiments.framework - INFO - Saving 5 plots to /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/plots
2025-10-27 12:52:41,978 - experiments.framework - WARNING - Failed to save plot data_distribution_comparison: name 'plt' is not defined
2025-10-27 12:52:42,692 - experiments.framework - WARNING - Failed to save plot data_validation_block_covariance_matrix: name 'plt' is not defined
2025-10-27 12:52:43,401 - experiments.framework - WARNING - Failed to save plot data_validation_inter_vs_intra_correlation: name 'plt' is not defined
2025-10-27 12:52:44,106 - experiments.framework - WARNING - Failed to save plot snr_analysis_volume_lentiform_voxels: name 'plt' is not defined
2025-10-27 12:52:44,816 - experiments.framework - WARNING - Failed to save plot snr_analysis_clinical: name 'plt' is not defined
2025-10-27 12:52:44,816 - experiments.framework - INFO - All plots saved to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/01_data_validation_fixed_K7_percW33_slab4_2_tree10/plots
2025-10-27 12:52:44,816 - experiments.data_validation - INFO - âœ… Data validation completed successfully
2025-10-27 12:52:44,930 - experiments.data_validation - INFO - ðŸ§¹ Memory cleanup completed
2025-10-27 12:52:44,930 - __main__ - INFO - ðŸ“Š Data validation loaded data: 2 views
2025-10-27 12:52:44,930 - __main__ - INFO -    Strategy: unknown
2025-10-27 12:52:44,930 - __main__ - INFO - ================================================================================
2025-10-27 12:52:44,930 - __main__ - INFO - ðŸ”¬ 3/4 STARTING FACTOR STABILITY ANALYSIS
2025-10-27 12:52:44,930 - __main__ - INFO - ================================================================================
2025-10-27 12:52:44,930 - __main__ - INFO -    â†’ Using shared data from previous experiments
2025-10-27 12:52:44,930 - __main__ - INFO -    â†’ X_list: 2 views
2025-10-27 12:52:44,930 - __main__ - INFO -       View 0: (86, 7201)
2025-10-27 12:52:44,930 - __main__ - INFO -       View 1: (86, 14)
2025-10-27 12:52:44,930 - __main__ - INFO -    Factor stability config from config.yaml: K=20, percW=None, num_chains=4
2025-10-27 12:52:44,930 - __main__ - INFO -    Using command-line K override: 7 (config.yaml has 20)
2025-10-27 12:52:44,931 - __main__ - INFO - Auto-configured system: 21.3GB memory limit
2025-10-27 12:52:44,933 - __main__ - INFO - ðŸ“ Log handler already exists for results/experiments.log - skipping duplicate
2025-10-27 12:52:44,933 - __main__ - INFO - ExperimentFramework initialized with output dir: results
2025-10-27 12:52:44,933 - __main__ - INFO - Auto-configured system: 21.3GB memory limit
2025-10-27 12:52:44,933 - __main__ - INFO - Memory optimizer initialized with 21.3GB limit
2025-10-27 12:52:44,934 - __main__ - INFO - Data streaming components initialized
2025-10-27 12:52:44,934 - __main__ - INFO - MCMC memory optimizer initialized
2025-10-27 12:52:44,934 - __main__ - INFO - ðŸ“ Set base_output_dir to run directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029
2025-10-27 12:52:44,934 - __main__ - INFO - ðŸ“ Created factor_stability experiment directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/02_factor_stability_fixed_K7_percW33_slab4_2_tree10
2025-10-27 12:52:44,934 - __main__ - INFO -    Using shared data: 2 views
2025-10-27 12:52:44,934 - __main__ - INFO -    Views: ['volume_lentiform_voxels', 'clinical']
2025-10-27 12:52:44,934 - __main__ - INFO -    Using global model hyperparameters: percW=33, slab_df=4, slab_scale=2
2025-10-27 12:52:44,934 - __main__ - INFO -    Detected 2 data views/sources from X_list
2025-10-27 12:52:44,934 - __main__ - INFO -    Using parameters from config.yaml:
2025-10-27 12:52:44,934 - __main__ - INFO -    - K=7, percW=33, slab_df=4, slab_scale=2
2025-10-27 12:52:44,934 - __main__ - INFO -    - num_samples=10000, num_warmup=3000
2025-10-27 12:52:44,934 - __main__ - INFO -    - target_accept_prob=0.8, max_tree_depth=10, dense_mass=False
2025-10-27 12:52:44,934 - __main__ - INFO -    - cosine_threshold=0.8, min_match_rate=0.5
2025-10-27 12:52:44,934 - __main__ - INFO -    Running 4 chains with K=7 factors...
2025-10-27 12:52:44,934 - __main__ - INFO -    This will take approximately 40 minutes
2025-10-27 12:52:44,935 - __main__ - INFO - ðŸ“ Experiment output directory set to: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/02_factor_stability_fixed_K7_percW33_slab4_2_tree10
2025-10-27 12:52:44,935 - __main__ - INFO - ðŸ“ Using unified pipeline logging: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/experiments.log
2025-10-27 12:52:44,935 - __main__ - INFO -    Skipping experiment-specific log file creation
2025-10-27 12:52:44,935 - __main__ - INFO - ================================================================================
2025-10-27 12:52:44,935 - __main__ - INFO - FACTOR STABILITY ANALYSIS - STARTING
2025-10-27 12:52:44,936 - __main__ - INFO - ================================================================================
2025-10-27 12:52:44,936 - __main__ - INFO - Output directory: /cs/student/msc/aibh/2024/madhavan/sgfa_qmap-pd/results/all_rois-lentiform_conf-age+sex+tiv_K7_run_20251027_125029/02_factor_stability_fixed_K7_percW33_slab4_2_tree10
2025-10-27 12:52:44,937 - __main__ - INFO - Running factor stability analysis with 4 independent chains
2025-10-27 12:52:44,937 - __main__ - INFO - Cosine similarity threshold: 0.8
2025-10-27 12:52:44,937 - __main__ - INFO - Minimum match rate: 0.5
2025-10-27 12:52:44,937 - __main__ - INFO - View names: ['volume_lentiform_voxels', 'clinical']
2025-10-27 12:52:44,937 - __main__ - INFO - Feature counts per view: {'volume_lentiform_voxels': 7201, 'clinical': 14}
2025-10-27 12:52:44,943 - __main__ - INFO - ================================================================================
2025-10-27 12:52:44,943 - __main__ - INFO - RUNNING 4 CHAINS WITH METHOD: parallel
2025-10-27 12:52:44,943 - __main__ - INFO - ================================================================================
2025-10-27 12:52:46,404 - __main__ - INFO - Base seed: 42
2025-10-27 12:52:46,404 - __main__ - INFO - MCMC config: samples=10000, warmup=3000, chains=4
2025-10-27 12:52:46,404 - __main__ - INFO - JAX will automatically split PRNG key for independent chains
2025-10-27 12:52:46,404 - __main__ - INFO - Chain RNG keys computed via fold_in for reproducibility
2025-10-27 12:52:46,522 - __main__ - INFO - Starting SGFA analysis with 4 chains...
2025-10-27 12:52:46,522 - __main__ - INFO - ðŸ”¬ Factor stability mode: Capturing full posterior geometry diagnostics
2025-10-27 12:52:46,522 - __main__ - INFO - ================================================================================
2025-10-27 12:52:46,522 - __main__ - INFO - _RUN_SGFA_ANALYSIS - STARTING
2025-10-27 12:52:46,522 - __main__ - INFO - ================================================================================
2025-10-27 12:52:46,523 - __main__ - INFO - Running SGFA: K=7, n_subjects=86, n_features=7215
2025-10-27 12:52:46,543 - models.models_integration - INFO -    Total features: 7,215
2025-10-27 12:52:46,543 - models.models_integration - INFO -    Views: 2
2025-10-27 12:52:46,543 - models.models_integration - INFO -    Subjects: 86
2025-10-27 12:52:46,543 - models.models_integration - INFO -    Has imaging data: True
2025-10-27 12:52:46,543 - models.models_integration - INFO - âœ… Selected model type: sparse_gfa_fixed
2025-10-27 12:52:46,543 - models.models_integration - INFO - ðŸ—ï¸ Creating model instance: sparse_gfa_fixed
2025-10-27 12:52:46,543 - models.models_integration - INFO -    Factory method: True
2025-10-27 12:52:46,543 - models.models_integration - INFO -  Model type: sparse_gfa_fixed
2025-10-27 12:52:46,543 - models.models_integration - INFO -  Model factory: True
2025-10-27 12:52:46,543 - models.models_integration - INFO -  Structured management: True
2025-10-27 12:52:46,543 - __main__ - INFO - MCMC configuration: warmup=3000, samples=10000, chains=4
2025-10-27 12:52:46,544 - __main__ - INFO - NUTS kernel parameters: target_accept_prob=0.8, max_tree_depth=10, dense_mass=False
2025-10-27 12:52:46,544 - __main__ - INFO - Creating MCMC sampler with chain_method=parallel...
2025-10-27 12:52:46,544 - __main__ - WARNING - âš ï¸  Running chains in explicit sequential mode with JAX cache clearing to prevent OOM
2025-10-27 12:52:46,544 - __main__ - WARNING -     (NumPyro's default chain execution can cause GPU memory accumulation)
2025-10-27 12:52:46,544 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 12:52:46,545 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 12:52:46,545 - __main__ - INFO -       Using init_params: False
2025-10-27 14:18:23,040 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-27 14:18:23,040 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-27 14:18:23,041 - __main__ - INFO -      View 1 (volume_lentiform_voxels): Ï„â‚€_W = 0.300000 | D = 7201 features (high-D (>200), floor=0.3)
2025-10-27 14:18:23,041 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 14:18:23,041 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 0.023155 Â± 0.052659
2025-10-27 14:18:23,042 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 611.825500 Â± 153.538208
2025-10-27 14:18:23,042 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.080175 Â± 0.063979
2025-10-27 14:18:23,042 - __main__ - INFO -       c_W (slab scale, loadings): 387.279449
2025-10-27 14:18:23,043 - __main__ - INFO -       c_Z (slab scale, factors): 2.416999
2025-10-27 14:18:32,143 - __main__ - INFO - âœ… Chain 1 cleanup complete
2025-10-27 14:18:43,681 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 14:18:43,681 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 14:18:43,681 - __main__ - INFO -       Using init_params: False
2025-10-27 15:45:17,761 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-27 15:45:17,762 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-27 15:45:17,762 - __main__ - INFO -      View 1 (volume_lentiform_voxels): Ï„â‚€_W = 0.300000 | D = 7201 features (high-D (>200), floor=0.3)
2025-10-27 15:45:17,762 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 15:45:17,763 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 0.047720 Â± 0.070339
2025-10-27 15:45:17,763 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 1837.390015 Â± 283.792114
2025-10-27 15:45:17,763 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.363118 Â± 0.291324
2025-10-27 15:45:17,764 - __main__ - INFO -       c_W (slab scale, loadings): 212.833572
2025-10-27 15:45:17,764 - __main__ - INFO -       c_Z (slab scale, factors): 1.933290
2025-10-27 15:45:32,124 - __main__ - INFO - âœ… Chain 2 cleanup complete
2025-10-27 15:45:46,198 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 15:45:46,198 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 15:45:46,198 - __main__ - INFO -       Using init_params: False
2025-10-27 16:20:08,058 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-27 16:20:08,059 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-27 16:20:08,059 - __main__ - INFO -      View 1 (volume_lentiform_voxels): Ï„â‚€_W = 0.300000 | D = 7201 features (high-D (>200), floor=0.3)
2025-10-27 16:20:08,059 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 16:20:08,071 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 0.085899 Â± 0.105139
2025-10-27 16:20:08,071 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 21805.154297 Â± 96140.617188
2025-10-27 16:20:08,072 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.010248 Â± 0.034137
2025-10-27 16:20:08,072 - __main__ - INFO -       c_W (slab scale, loadings): 33.780342
2025-10-27 16:20:08,072 - __main__ - INFO -       c_Z (slab scale, factors): 6.399428
2025-10-27 16:20:17,344 - __main__ - INFO - âœ… Chain 3 cleanup complete
2025-10-27 16:20:28,881 - __main__ - INFO -       Model: SparseGFAFixedModel
2025-10-27 16:20:28,881 - __main__ - INFO -       Warmup: 3000, Samples: 10000
2025-10-27 16:20:28,881 - __main__ - INFO -       Using init_params: False
2025-10-27 17:46:00,419 - __main__ - INFO -    ðŸ“Š Global shrinkage prior Ï„â‚€_Z = 0.050000
2025-10-27 17:46:00,420 - __main__ - INFO -    ðŸ“Š View-specific global shrinkage priors (Ï„â‚€_W):
2025-10-27 17:46:00,420 - __main__ - INFO -      View 1 (volume_lentiform_voxels): Ï„â‚€_W = 0.300000 | D = 7201 features (high-D (>200), floor=0.3)
2025-10-27 17:46:00,421 - __main__ - INFO -      View 2 (clinical): Ï„â‚€_W = 0.800000 | D = 14 features (low-D (<50), floor=0.8)
2025-10-27 17:46:00,421 - __main__ - INFO -       Ï„_Z (global shrinkage, factors): 0.024954 Â± 0.058875
2025-10-27 17:46:00,421 - __main__ - INFO -       Ï„_W (global shrinkage, view 1): 1252.296997 Â± 333.491852
2025-10-27 17:46:00,422 - __main__ - INFO -       Ï„_W (global shrinkage, view 2): 0.082627 Â± 0.082032
2025-10-27 17:46:00,422 - __main__ - INFO -       c_W (slab scale, loadings): 422.934601
2025-10-27 17:46:00,422 - __main__ - INFO -       c_Z (slab scale, factors): 2.411836
2025-10-27 17:46:09,583 - __main__ - INFO - âœ… Chain 4 cleanup complete
2025-10-27 17:46:24,442 - __main__ - INFO - Got samples grouped by chain: 4 chains
2025-10-27 17:46:24,509 - __main__ - INFO - Stored full samples for 4 chains for MCMC diagnostics
2025-10-27 17:46:24,510 - __main__ - INFO - W_samples shape: (4, 10000, 7215, 7)
2025-10-27 17:46:24,510 - __main__ - INFO - Z_samples shape: (4, 10000, 86, 7)
2025-10-27 17:46:24,525 - __main__ - INFO -    Result keys: ['W_samples', 'Z_samples', 'samples', 'n_iterations', 'num_chains', 'convergence', 'execution_time', 'robustness_info']
2025-10-27 17:46:24,579 - __main__ - INFO - âœ… All 4 chains completed successfully
2025-10-27 17:46:24,766 - optimization.profiler - INFO - Performance: all_chains: 17618.105s, 26.69GB peak, 100.2% CPU
2025-10-27 17:46:24,767 - __main__ - INFO - ================================================================================
2025-10-27 17:46:24,767 - __main__ - INFO - EXTRACTING POSTERIOR GEOMETRY DIAGNOSTICS
2025-10-27 17:46:24,767 - __main__ - INFO - ================================================================================
2025-10-27 17:46:24,767 - __main__ - INFO -   âœ… Extracted posterior geometry diagnostics
2025-10-27 17:46:24,767 - __main__ - INFO - W_samples shape: (4, 10000, 7215, 7)
2025-10-27 17:46:24,767 - __main__ - INFO - Z_samples shape: (4, 10000, 86, 7)
2025-10-27 17:46:24,767 - __main__ - INFO - ================================================================================
2025-10-27 17:46:24,767 - __main__ - INFO - VALIDATING MCMC SAMPLES (NaN/Inf CHECK)
2025-10-27 17:46:24,767 - __main__ - INFO - ================================================================================
2025-10-27 17:46:28,065 - __main__ - INFO - W (factor loadings) validation:
2025-10-27 17:46:28,066 - __main__ - INFO -   Total elements: 2,020,200,000
2025-10-27 17:46:28,066 - __main__ - INFO -   NaN values: 0 (0.0000%)
2025-10-27 17:46:28,066 - __main__ - INFO -   Inf values: 0 (0.0000%)
2025-10-27 17:46:28,066 - __main__ - INFO -   âœ“ All W samples are valid (finite)
2025-10-27 17:46:28,104 - __main__ - INFO - Z (factor scores) validation:
2025-10-27 17:46:28,104 - __main__ - INFO -   Total elements: 24,080,000
2025-10-27 17:46:28,104 - __main__ - INFO -   NaN values: 0 (0.0000%)
2025-10-27 17:46:28,104 - __main__ - INFO -   Inf values: 0 (0.0000%)
2025-10-27 17:46:28,104 - __main__ - INFO -   âœ“ All Z samples are valid (finite)
2025-10-27 17:46:28,104 - __main__ - INFO - ================================================================================
2025-10-27 17:46:28,104 - __main__ - INFO - âœ“ SAMPLE VALIDATION PASSED - All samples are valid
2025-10-27 17:46:28,104 - __main__ - INFO - ================================================================================
2025-10-27 17:46:28,104 - __main__ - INFO - Processing chain 1/4...
2025-10-27 17:46:28,266 - __main__ - INFO - Chain 0 processed: W shape: (7201, 7), Z shape: (86, 7)
2025-10-27 17:46:28,266 - __main__ - INFO - Processing chain 2/4...
2025-10-27 17:46:28,426 - __main__ - INFO - Chain 1 processed: W shape: (7201, 7), Z shape: (86, 7)
2025-10-27 17:46:28,426 - __main__ - INFO - Processing chain 3/4...
2025-10-27 17:46:28,589 - __main__ - INFO - Chain 2 processed: W shape: (7201, 7), Z shape: (86, 7)
2025-10-27 17:46:28,589 - __main__ - INFO - Processing chain 4/4...
2025-10-27 17:46:28,751 - __main__ - INFO - Chain 3 processed: W shape: (7201, 7), Z shape: (86, 7)
2025-10-27 17:46:28,751 - __main__ - INFO - âœ… All chains completed in 17618.1s (293.6 min)
2025-10-27 17:46:28,751 - __main__ - INFO - ================================================================================
2025-10-27 17:46:28,751 - __main__ - INFO - ASSESSING FACTOR STABILITY ACROSS CHAINS
2025-10-27 17:46:28,751 - __main__ - INFO - ================================================================================
2025-10-27 17:46:28,751 - __main__ - INFO - Number of chains to analyze: 4
2025-10-27 17:46:28,751 - __main__ - INFO - Cosine threshold: 0.8
2025-10-27 17:46:28,751 - __main__ - INFO - Min match rate: 0.5
2025-10-27 17:46:28,751 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 17:46:28,751 - analysis.factor_stability - INFO - ASSESS_FACTOR_STABILITY_COSINE - STARTING
2025-10-27 17:46:28,751 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 17:46:28,751 - analysis.factor_stability - INFO - Number of chains: 4
2025-10-27 17:46:28,752 - analysis.factor_stability - INFO - Similarity threshold: 0.8
2025-10-27 17:46:28,752 - analysis.factor_stability - INFO - Min match rate: 0.5
2025-10-27 17:46:28,752 - analysis.factor_stability - INFO - Chain 0: W type=<class 'list'>, samples=True
2025-10-27 17:46:28,752 - analysis.factor_stability - INFO - Chain 1: W type=<class 'list'>, samples=True
2025-10-27 17:46:28,752 - analysis.factor_stability - INFO - Chain 2: W type=<class 'list'>, samples=True
2025-10-27 17:46:28,752 - analysis.factor_stability - INFO - Chain 3: W type=<class 'list'>, samples=True
2025-10-27 17:46:28,752 - analysis.factor_stability - INFO - Chain 0: Averaging 10000 posterior samples
2025-10-27 17:46:28,909 - analysis.factor_stability - INFO - Chain 0: Averaged W samples -> shape (7215, 7)
2025-10-27 17:46:28,909 - analysis.factor_stability - INFO - Chain 1: Averaging 10000 posterior samples
2025-10-27 17:46:29,066 - analysis.factor_stability - INFO - Chain 1: Averaged W samples -> shape (7215, 7)
2025-10-27 17:46:29,066 - analysis.factor_stability - INFO - Chain 2: Averaging 10000 posterior samples
2025-10-27 17:46:29,227 - analysis.factor_stability - INFO - Chain 2: Averaged W samples -> shape (7215, 7)
2025-10-27 17:46:29,227 - analysis.factor_stability - INFO - Chain 3: Averaging 10000 posterior samples
2025-10-27 17:46:29,387 - analysis.factor_stability - INFO - Chain 3: Averaged W samples -> shape (7215, 7)
2025-10-27 17:46:29,387 - analysis.factor_stability - INFO - Factor loading matrices: D=7215 features, K=7 factors
2025-10-27 17:46:29,390 - analysis.factor_stability - INFO - Chain 0: Averaged Z shape (86, 7)
2025-10-27 17:46:29,392 - analysis.factor_stability - INFO - Chain 1: Averaged Z shape (86, 7)
2025-10-27 17:46:29,395 - analysis.factor_stability - INFO - Chain 2: Averaged Z shape (86, 7)
2025-10-27 17:46:29,397 - analysis.factor_stability - INFO - Chain 3: Averaged Z shape (86, 7)
2025-10-27 17:46:29,397 - analysis.factor_stability - INFO - Step 2: Matching 7 factors across 4 chains
2025-10-27 17:46:29,397 - analysis.factor_stability - INFO -   Using sign-invariant cosine similarity (handles factor sign flips)
2025-10-27 17:46:29,397 - analysis.factor_stability - INFO -   Zero-vector detection enabled (threshold: 1e-10)
2025-10-27 17:46:29,397 - analysis.factor_stability - INFO -   Processing factor 0/7
2025-10-27 17:46:29,443 - analysis.factor_stability - INFO - Factor 0: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 17:46:29,445 - analysis.factor_stability - INFO - Factor 1: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 17:46:29,449 - analysis.factor_stability - INFO - Factor 3: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 17:46:29,450 - analysis.factor_stability - INFO - Factor 4: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 17:46:29,450 - analysis.factor_stability - INFO -   Processing factor 5/7
2025-10-27 17:46:29,452 - analysis.factor_stability - INFO - Factor 5: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 17:46:29,454 - analysis.factor_stability - INFO - Factor 6: ROBUST (matched in 4/4 chains, rate=100.00%)
2025-10-27 17:46:29,454 - analysis.factor_stability - INFO - 
ðŸ“Š Cosine Similarity Edge Case Summary:
2025-10-27 17:46:29,455 - analysis.factor_stability - INFO -   Zero reference vectors encountered: 0
2025-10-27 17:46:29,455 - analysis.factor_stability - INFO -   Zero comparison vectors encountered: 0
2025-10-27 17:46:29,455 - analysis.factor_stability - INFO -   Sign flips detected (|sim_raw| < -0.5): 0
2025-10-27 17:46:29,455 - analysis.factor_stability - INFO -   Total factor comparisons: 147
2025-10-27 17:46:29,455 - analysis.factor_stability - INFO - Computing consensus loadings for all 7 factors
2025-10-27 17:46:29,455 - analysis.factor_stability - INFO -   (Stable factors: 6/7)
2025-10-27 17:46:29,496 - analysis.factor_stability - INFO - Computing consensus scores for all 7 factors
2025-10-27 17:46:29,503 - analysis.factor_stability - INFO - Consensus Z computed with uncertainty quantification
2025-10-27 17:46:29,503 - analysis.factor_stability - INFO -   Median Z: shape (86, 7)
2025-10-27 17:46:29,503 - analysis.factor_stability - INFO -   Mean std per subject: 0.198
2025-10-27 17:46:29,507 - analysis.factor_stability - INFO -   Max std per subject: 19.173
2025-10-27 17:46:29,507 - analysis.factor_stability - WARNING -   âš ï¸  26 subjects have high uncertainty (>95th percentile)
2025-10-27 17:46:29,507 - analysis.factor_stability - WARNING -      Consider: More chains, longer sampling, or model issues
2025-10-27 17:46:29,507 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 17:46:29,507 - analysis.factor_stability - INFO - ASSESS_FACTOR_STABILITY_COSINE - COMPLETED
2025-10-27 17:46:29,507 - analysis.factor_stability - INFO - ================================================================================
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO - Results:
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - Stable factors: 6/7
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - Stability rate: 85.7%
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - Stable factor indices: [0, 1, 3, 4, 5, 6]
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - Consensus W shape: (7215, 7)
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - Consensus Z shape: (86, 7)
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - Z posterior uncertainty quantified (std, CI)
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO - Factor stability analysis complete:
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - 6/7 factors are robust (85.7%)
2025-10-27 17:46:29,508 - analysis.factor_stability - INFO -   - Stable factor indices: [0, 1, 3, 4, 5, 6]
2025-10-27 17:46:29,508 - __main__ - INFO - âœ… Stability analysis completed
2025-10-27 17:46:29,514 - __main__ - INFO -    Stable factors: 6/7
2025-10-27 17:46:29,514 - __main__ - INFO -    Stability rate: 85.7%
2025-10-27 17:46:29,514 - __main__ - INFO - ================================================================================
2025-10-27 17:46:29,514 - __main__ - INFO - COUNTING EFFECTIVE FACTORS PER CHAIN
2025-10-27 17:46:29,514 - __main__ - INFO - ================================================================================
2025-10-27 17:46:29,514 - __main__ - INFO - Thresholds:
2025-10-27 17:46:29,514 - __main__ - INFO -   - Sparsity: 0.001, Min nonzero %: 0.01
2025-10-27 17:46:29,514 - __main__ - INFO -   - ARD precision threshold: 100.0
2025-10-27 17:46:29,514 - __main__ - INFO -   - ARD variance threshold: 0.01
2025-10-27 17:46:29,514 - __main__ - WARNING - âš  tau_W samples not available - ARD-based method will be skipped
2025-10-27 17:46:29,514 - __main__ - INFO - 
============================================================
2025-10-27 17:46:29,514 - __main__ - INFO - CHAIN 0 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 17:46:29,515 - __main__ - INFO - ============================================================
2025-10-27 17:46:29,515 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 7215 total features, K=7
2025-10-27 17:46:29,516 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 17:46:29,517 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:29,517 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:29,517 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:29,517 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=7215, K=7
2025-10-27 17:46:36,105 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 17:46:36,105 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:36,105 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:36,105 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:36,106 - __main__ - INFO - 
Chain 0 - Method Comparison:
2025-10-27 17:46:36,106 - __main__ - INFO -   Posterior Mean:    7/7 effective
2025-10-27 17:46:36,106 - __main__ - INFO -   Posterior Samples: 7/7 effective
2025-10-27 17:46:36,106 - __main__ - INFO - 
============================================================
2025-10-27 17:46:36,106 - __main__ - INFO - CHAIN 1 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 17:46:36,106 - __main__ - INFO - ============================================================
2025-10-27 17:46:36,106 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 7215 total features, K=7
2025-10-27 17:46:36,107 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 17:46:36,107 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:36,107 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:36,107 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:36,107 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=7215, K=7
2025-10-27 17:46:42,298 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 17:46:42,298 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:42,298 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:42,298 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:42,299 - __main__ - INFO - 
Chain 1 - Method Comparison:
2025-10-27 17:46:42,299 - __main__ - INFO -   Posterior Mean:    7/7 effective
2025-10-27 17:46:42,299 - __main__ - INFO -   Posterior Samples: 7/7 effective
2025-10-27 17:46:42,299 - __main__ - INFO - 
============================================================
2025-10-27 17:46:42,299 - __main__ - INFO - CHAIN 2 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 17:46:42,299 - __main__ - INFO - ============================================================
2025-10-27 17:46:42,299 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 7215 total features, K=7
2025-10-27 17:46:42,300 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 17:46:42,300 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:42,300 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:42,300 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:42,301 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=7215, K=7
2025-10-27 17:46:48,965 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 17:46:48,965 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:48,965 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:48,965 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:48,966 - __main__ - INFO - 
Chain 2 - Method Comparison:
2025-10-27 17:46:48,966 - __main__ - INFO -   Posterior Mean:    7/7 effective
2025-10-27 17:46:48,966 - __main__ - INFO -   Posterior Samples: 7/7 effective
2025-10-27 17:46:48,966 - __main__ - INFO - 
============================================================
2025-10-27 17:46:48,966 - __main__ - INFO - CHAIN 3 - EFFECTIVE FACTOR ANALYSIS
2025-10-27 17:46:48,966 - __main__ - INFO - ============================================================
2025-10-27 17:46:48,966 - analysis.factor_stability - INFO - Counting effective factors in multi-view W: 2 views, 7215 total features, K=7
2025-10-27 17:46:48,967 - analysis.factor_stability - INFO - Effective factor analysis:
2025-10-27 17:46:48,968 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:48,968 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:48,968 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:48,968 - analysis.factor_stability - INFO - Counting effective factors from 10000 posterior samples: D=7215, K=7
2025-10-27 17:46:55,083 - analysis.factor_stability - INFO - Effective factor analysis (from samples):
2025-10-27 17:46:55,083 - analysis.factor_stability - INFO -   - 7/7 factors are effective
2025-10-27 17:46:55,083 - analysis.factor_stability - INFO -   - Shrinkage rate: 0.0%
2025-10-27 17:46:55,083 - analysis.factor_stability - INFO -   - Effective factor indices: [0, 1, 2, 3, 4, 5, 6]
2025-10-27 17:46:55,084 - __main__ - INFO - 
Chain 3 - Method Comparison:
2025-10-27 17:46:55,084 - __main__ - INFO -   Posterior Mean:    7/7 effective
2025-10-27 17:46:55,084 - __main__ - INFO -   Posterior Samples: 7/7 effective
2025-10-27 17:46:55,084 - __main__ - INFO - 
================================================================================
2025-10-27 17:46:55,084 - __main__ - INFO - EFFECTIVE FACTOR SUMMARY (Using preferred method)
2025-10-27 17:46:55,084 - __main__ - INFO - ================================================================================
2025-10-27 17:46:55,085 - __main__ - INFO - Chain 0 (Posterior Samples): 7/7 effective factors
2025-10-27 17:46:55,085 - __main__ - INFO - Chain 1 (Posterior Samples): 7/7 effective factors
2025-10-27 17:46:55,085 - __main__ - INFO - Chain 2 (Posterior Samples): 7/7 effective factors
2025-10-27 17:46:55,085 - __main__ - INFO - Chain 3 (Posterior Samples): 7/7 effective factors
2025-10-27 17:46:55,085 - __main__ - INFO - ================================================================================
2025-10-27 17:46:55,085 - __main__ - INFO - R-HAT CONVERGENCE DIAGNOSTICS
2025-10-27 17:46:55,085 - __main__ - INFO - ================================================================================
2025-10-27 17:46:55,085 - __main__ - INFO - NOTE: Raw R-hat reported for completeness. Aligned R-hat (below) is primary metric.
2025-10-27 17:46:55,085 - __main__ - INFO - 
