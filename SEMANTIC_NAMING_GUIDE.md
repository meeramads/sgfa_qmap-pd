# Semantic Directory Naming Guide

## Overview

The experiment framework automatically generates semantic directory names that include all key experimental parameters. This makes it easy to identify and compare runs.

## Directory Name Format

```
{experiment_type}_{model}_{K}_{percW}_{slab}_{MAD}_{tree}_{timestamp}
```

### Components

1. **Experiment Type** - Base experiment name
   - `robustness_tests`
   - `factor_stability`
   - `data_validation`
   - etc.

2. **Model Type** (NEW!) - Only if non-default
   - `fixed` - sparse_gfa_fixed (convergence-improved model)
   - `neuro` - neuroGFA (neuroimaging-specific)
   - `std` - standard_gfa/GFA
   - (no suffix) - sparseGFA (default)

3. **K** - Number of latent factors
   - `K2`, `K10`, `K20`, `K50`

4. **percW** - Sparsity percentage
   - `percW10`, `percW20`, `percW33`, `percW50`

5. **Slab Parameters** - Prior distribution parameters
   - `slab4_2` - slab_df=4, slab_scale=2

6. **MAD Threshold** - QC outlier detection threshold
   - `MAD3.0`, `MAD4.5`

7. **Tree Depth** - NUTS max tree depth (only if non-default)
   - `tree10` (default is 13, so only appears if different)

8. **Timestamp** - Run date/time
   - `20251020_143045` (YYYYMMDD_HHMMSS)

## Examples

### Using config_convergence.yaml

**Configuration:**
```yaml
model:
  model_type: "sparse_gfa_fixed"
  K: 20
  percW: 33
  slab_df: 4
  slab_scale: 2

preprocessing:
  qc_outlier_threshold: 3.0

factor_stability:
  max_tree_depth: 10
```

**Resulting Directories:**

```
results/
├── robustness_tests_fixed_K2_percW33_slab4_2_MAD3.0_tree10_20251020_143045/
├── factor_stability_fixed_K20_percW33_slab4_2_MAD3.0_tree10_20251020_143120/
└── factor_stability_fixed_K50_percW10_slab4_2_MAD3.0_tree10_20251020_143145/
```

### Comparing Different Model Types

**sparse_gfa_fixed (convergence-improved):**
```
factor_stability_fixed_K20_percW33_slab4_2_MAD3.0_tree10_20251020_143120/
```

**sparseGFA (default):**
```
factor_stability_K20_percW33_slab4_2_MAD3.0_tree10_20251020_143120/
```

**neuroGFA (neuroimaging-specific):**
```
factor_stability_neuro_K20_percW33_slab4_2_MAD3.0_tree10_20251020_143120/
```

### Parameter Sweep Example

Testing different K values with fixed model:

```
factor_stability_fixed_K2_percW33_slab4_2_MAD3.0_tree10_20251020_140000/
factor_stability_fixed_K10_percW33_slab4_2_MAD3.0_tree10_20251020_141500/
factor_stability_fixed_K20_percW33_slab4_2_MAD3.0_tree10_20251020_143000/
factor_stability_fixed_K50_percW33_slab4_2_MAD3.0_tree10_20251020_144500/
```

Testing different sparsity levels:

```
robustness_tests_fixed_K2_percW10_slab4_2_MAD3.0_tree10_20251020_150000/
robustness_tests_fixed_K2_percW20_slab4_2_MAD3.0_tree10_20251020_151500/
robustness_tests_fixed_K2_percW33_slab4_2_MAD3.0_tree10_20251020_153000/
```

## Benefits

### 1. Easy Identification
Instantly see what configuration was used without opening files:
```bash
ls results/
# factor_stability_fixed_K20_percW33_slab4_2_MAD3.0_tree10_20251020_143120/
#                  ^^^^^ ^^^ ^^^^^^^ ^^^^^^^^ ^^^^^^^ ^^^^^^
#                   |     |     |       |        |       |
#                model   K  percW   slab      MAD    tree
```

### 2. Simple Comparison
Compare runs with different parameters:
```bash
# Compare different K values
ls results/ | grep "fixed_K" | sort

# Compare different models
ls results/ | grep "factor_stability.*K20"
```

### 3. Pattern Matching
Use wildcards to find specific configurations:
```bash
# All fixed model runs with K=20
ls results/factor_stability_fixed_K20_*

# All runs with MAD threshold 3.0
ls results/*_MAD3.0_*/

# All runs with tree depth 10
ls results/*_tree10_*/
```

### 4. Organization
Results are self-documenting and easy to organize:
```bash
# Archive old runs
mv results/*_202510* archived_results/

# Find recent convergence tests
ls -lt results/factor_stability_fixed_* | head
```

## Implementation

The semantic naming is automatically generated by `ExperimentFramework`:

```python
# In experiments/framework.py
def _generate_semantic_experiment_name(self, base_name: str, config: ExperimentConfig) -> str:
    """Generate semantic name from experiment config."""
    name_parts = [base_name]

    # Add model type abbreviation
    if config.model_type == "sparse_gfa_fixed":
        name_parts.append("fixed")

    # Add parameters
    if config.K is not None:
        name_parts.append(f"K{config.K}")
    # ... etc

    return "_".join(name_parts)
```

## Customization

To modify the naming convention:

1. Edit `experiments/framework.py:_generate_semantic_experiment_name()`
2. Add/remove parameters as needed
3. Update abbreviations for clarity

Example: Adding algorithm variant:
```python
if config.algorithm == "gibbs":
    name_parts.append("gibbs")
elif config.algorithm == "nuts":
    name_parts.append("nuts")
```

## Best Practices

### 1. Keep Abbreviations Short
- ✅ `fixed` for sparse_gfa_fixed
- ❌ `sparse_gfa_fixed` (too long)

### 2. Use Only Key Parameters
- ✅ Include: K, percW, MAD threshold
- ❌ Don't include: num_samples (not a key experimental variable)

### 3. Maintain Consistency
- All runs should follow the same naming pattern
- Makes comparison and analysis easier

### 4. Document Changes
- If you modify the naming convention, document it
- Update this guide accordingly

## Troubleshooting

### Directory Name Too Long

If directory names are too long, remove less important parameters:

```python
# Remove slab parameters if always the same
# if config.slab_df is not None and config.slab_scale is not None:
#     name_parts.append(f"slab{config.slab_df:.0f}_{config.slab_scale:.0f}")
```

### Parameters Not Appearing

Ensure ExperimentConfig has the parameter set:

```python
experiment_config = ExperimentConfig(
    experiment_name="factor_stability",
    model_type=model_type,  # Make sure this is set!
    K=K_value,
    percW=percW_value,
    # ... etc
)
```

### Wrong Model Type Label

Check the abbreviation mapping in `_generate_semantic_experiment_name()`:

```python
if model_type == "sparse_gfa_fixed":
    name_parts.append("fixed")  # This is the abbreviation
```

## Testing

Test the naming convention:

```bash
python test_semantic_naming.py
```

This will show example directory names for different configurations.

---

**Last Updated:** October 20, 2025
**Version:** 2.0 (Added model type support)
